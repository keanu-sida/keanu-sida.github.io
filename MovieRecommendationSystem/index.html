<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Movie Recommendation System | Keanu Sida</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
<section id="project---recommendation-systems-movie-recommendation-system" class="cell markdown" id="Cf3GloRNvOOG">
<h1><strong>Project: Movie Recommendation System</strong></h1>
<h3><em>by Keanu Sida</em></h3>
<h2 id="-context"><strong>Context</strong></h2>
<p>Online streaming platforms like <strong>Netflix</strong> have plenty of movies in their repository and if we can build a <strong>Recommendation System</strong> to recommend <strong>relevant movies</strong> to users, based on their <strong>historical interactions</strong>, this would <strong>improve customer satisfaction</strong> thereby improving the revenue of the platform. The techniques employed here can be employed for any item for which a recommendation system is appropriate.</p>
<hr/>
<h2 id="-objective"><strong>Objective</strong></h2>
<p>This project features three kinds of recommendation systems:</p>
<ol>
<li>Knowledge/Rank based recommendation system</li>
<li>Similarity-Based Collaborative filtering</li>
<li>Matrix Factorization Based Collaborative Filtering</li>
</ol>
<p>I used the <strong>ratings</strong> dataset, which can be downloaded as a .csv file <a href='./ratings.csv' target="_blank">here</a>.</p>
<hr />
<h2 id="-dataset"><strong>Dataset</strong></h2>
<p>The <strong>ratings</strong> dataset contains the following attributes:</p>
<ul>
<li>userId</li>
<li>movieId</li>
<li>rating</li>
<li>timestamp</li>
</ul>
</section>
<div class="cell markdown" id="jRmwxTz1xKew">
<p><strong>Installing surprise library</strong></p>
</div>
<div class="cell code" data-execution_count="6" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="J1TItcxtwIAZ" data-outputId="d4e0f081-d967-4d6d-89eb-2ace105c1d5d">
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install surprise library</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install surprise</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Collecting surprise
  Downloading surprise-0.1-py2.py3-none-any.whl (1.8 kB)
Collecting scikit-surprise
  Downloading scikit-surprise-1.1.1.tar.gz (11.8 MB)
ent already satisfied: joblib&gt;=0.11 in /usr/local/lib/python3.7/dist-packages (from scikit-surprise-&gt;surprise) (1.2.0)
Requirement already satisfied: numpy&gt;=1.11.2 in /usr/local/lib/python3.7/dist-packages (from scikit-surprise-&gt;surprise) (1.21.6)
Requirement already satisfied: scipy&gt;=1.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-surprise-&gt;surprise) (1.7.3)
Requirement already satisfied: six&gt;=1.10.0 in /usr/local/lib/python3.7/dist-packages (from scikit-surprise-&gt;surprise) (1.15.0)
Building wheels for collected packages: scikit-surprise
  Building wheel for scikit-surprise (setup.py) ... e=scikit_surprise-1.1.1-cp37-cp37m-linux_x86_64.whl size=1633970 sha256=46c3bd64da03464dab9be98362f87962a4c28fa86ad1bfe137814015d8759182
  Stored in directory: /root/.cache/pip/wheels/76/44/74/b498c42be47b2406bd27994e16c5188e337c657025ab400c1c
Successfully built scikit-surprise
Installing collected packages: scikit-surprise, surprise
Successfully installed scikit-surprise-1.1.1 surprise-0.1
</code></pre>
</div>
</div>
<section id="importing-the-necessary-libraries-and-overview-of-the-dataset" class="cell markdown" id="9hczXgBkvOOG">
<h2><strong>Importing the necessary libraries and overview of the dataset</strong></h2>
</section>
<div class="cell code" data-execution_count="7" id="Gem2ozi_vOOG">
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Used to ignore the warning given as output of the code</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings                                 </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic libraries of python for numeric and dataframe computations</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np                              </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic library for data visualization</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt     </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Slightly advanced library for data visualization            </span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns                           </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># A dictionary output that does not raise a key error</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict             </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># A performance metrics in surprise</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> surprise <span class="im">import</span> accuracy</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Class is used to parse a file containing ratings, data should be in structure - user ; item ; rating</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> surprise.reader <span class="im">import</span> Reader</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Class for loading datasets</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> surprise.dataset <span class="im">import</span> Dataset</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co"># For model tuning model hyper-parameters</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> surprise.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co"># For splitting the rating data in train and test dataset</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> surprise.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co"># For implementing similarity based recommendation system</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> surprise.prediction_algorithms.knns <span class="im">import</span> KNNBasic</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co"># For implementing matrix factorization based recommendation system</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> surprise.prediction_algorithms.matrix_factorization <span class="im">import</span> SVD</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co"># For implementing cross validation</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> surprise.model_selection <span class="im">import</span> KFold</span></code></pre></div>
</div>
<section id="loading-the-data" class="cell markdown" id="ewHMWerQ2N9T">
<h3><strong>Loading the data</strong></h3>
</section>
<div class="cell code" data-execution_count="8" id="EdQIx3OLvOOG">
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the dataset</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>rating <span class="op">=</span> pd.read_csv(<span class="st">&#39;./ratings.csv&#39;</span>) <span class="co"></span></span></code></pre></div>
</div>
<div class="cell markdown" id="WAW3gTmB2N9a">
<p>Let's check the <strong>info</strong> of the data</p>
</div>
<div class="cell code" data-execution_count="9" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="8zF1K1hDvOOG" data-outputId="8b178bdd-96a7-424c-a2b9-9d020fd6a882">
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>rating.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 100004 entries, 0 to 100003
Data columns (total 4 columns):
 #   Column     Non-Null Count   Dtype  
---  ------     --------------   -----  
 0   userId     100004 non-null  int64  
 1   movieId    100004 non-null  int64  
 2   rating     100004 non-null  float64
 3   timestamp  100004 non-null  int64  
dtypes: float64(1), int64(3)
memory usage: 3.1 MB
</code></pre>
</div>
</div>
<div class="cell markdown" id="202Ux9MH2N9f">
<ul>
<li>There are <strong>1,00,004 observations</strong> and <strong>4 columns</strong> in the data</li>
<li>All the columns are of <strong>numeric data type</strong></li>
<li>The data type of the timestamp column is int64 which is not correct. We can convert this to DateTime format but <strong>we don't need timestamp for our analysis</strong>. Hence, <strong>we can drop this column</strong></li>
</ul>
</div>
<div class="cell code" data-execution_count="10" id="fltadjTcvOOH">
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dropping timestamp column</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>rating <span class="op">=</span> rating.drop([<span class="st">&#39;timestamp&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<section id="question-1-exploring-the-dataset-7-marks" class="cell markdown" id="mHOFHmoBwIAw">
<h2><strong>Step 1: Exploring the Dataset</strong></h2>
<p>Let's explore the dataset and answer some basic data-related questions:</p>
<p><strong>What do the top 5 rows of the data set look like?</strong></p>
</section>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"></span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>rating.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="11">

  <div id="df-b3f2fd42-8556-4f30-9582-3b2fb45a6d89">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>31</td>
      <td>2.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1029</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1061</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1129</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>1172</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-b3f2fd42-8556-4f30-9582-3b2fb45a6d89')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-b3f2fd42-8556-4f30-9582-3b2fb45a6d89 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-b3f2fd42-8556-4f30-9582-3b2fb45a6d89');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<section id="q-12-describe-the-distribution-of-ratings-1-mark" class="cell markdown" id="fBZYy0HavOOH">
<h3><strong>Q 1.2 Describe the distribution of ratings. (1 Mark)</strong></h3>
</section>
<div class="cell code" data-execution_count="12" data-colab="{&quot;height&quot;:293,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="lO-EYEl3wIA2" data-outputId="7d7ab750-56bc-4656-9970-0c99cdf2d2d1">
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______and complete the code</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>sns.countplot(x <span class="op">=</span> <span class="st">&quot;rating&quot;</span>, data <span class="op">=</span> rating)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.tick_params(labelsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Distribution of Ratings &quot;</span>, fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Ratings&quot;</span>, fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Number of Ratings&quot;</span>, fontsize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/954937daaf2bd7938cb76c2853611c572c02f4bc.png" /></p>
</div>
</div>
<div class="cell markdown" id="vgRDrtHhwIA4">
<p>Rating '4.0' has the highest count of ratings (&gt;30k). Rating '3.0' is second with 20K+ and Rating '5.0' is third in count of ratings with around 15K.</p>
<p>The ratings are biased towards these 3 numbers significantly more than others.</p>
</div>
<section id="q-13-what-is-the-total-number-of-unique-users-and-unique-movies-1-mark" class="cell markdown" id="UOBD03d9vOOH">
<h3><strong>Q 1.3 What is the total number of unique users and unique movies? (1 Mark)</strong></h3>
</section>
<div class="cell code" data-execution_count="13" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="RMpbsZGGvOOH" data-outputId="9662d882-bba8-4ee3-beaf-d2e6b37a72fb">
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding number of unique users</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rating[<span class="st">&#39;userId&#39;</span>].nunique()</span></code></pre></div>
<div class="output execute_result" data-execution_count="13">
<pre><code>671</code></pre>
</div>
</div>
<div class="cell markdown" id="CI8gofnx2N9m">
<p>There are <strong>671</strong> unique users in the data set.</p>
</div>
<div class="cell code" data-execution_count="14" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="9A6Qmo_6vOOH" data-outputId="992ca12a-f606-407d-840c-d943451a18d5">
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding number of unique movies</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>rating[<span class="st">&#39;movieId&#39;</span>].nunique()</span></code></pre></div>
<div class="output execute_result" data-execution_count="14">
<pre><code>9066</code></pre>
</div>
</div>
<div class="cell markdown" id="mDWJghQ62N9o">
<p>There are <strong>9066</strong> unique movies in the data set.</p>
</div>
<section id="q-14-is-there-a-movie-in-which-the-same-user-interacted-with-it-more-than-once-1-mark" class="cell markdown" id="mR9tzSzTvOOH">
<h3><strong>Q 1.4 Is there a movie in which the same user interacted with it more than once? (1 Mark)</strong></h3>
</section>
<div class="cell code" data-execution_count="15" data-colab="{&quot;height&quot;:455,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="xstEDCVfvOOH" data-outputId="1ea904d0-b887-446d-d0ae-0b719f392c3e">
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rating.groupby([<span class="st">&#39;userId&#39;</span>, <span class="st">&#39;movieId&#39;</span>]).count()</span></code></pre></div>
<div class="output execute_result" data-execution_count="15">

  <div id="df-eef6f178-d4f8-4607-b632-043fad289764">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>rating</th>
    </tr>
    <tr>
      <th>userId</th>
      <th>movieId</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">1</th>
      <th>31</th>
      <td>1</td>
    </tr>
    <tr>
      <th>1029</th>
      <td>1</td>
    </tr>
    <tr>
      <th>1061</th>
      <td>1</td>
    </tr>
    <tr>
      <th>1129</th>
      <td>1</td>
    </tr>
    <tr>
      <th>1172</th>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">671</th>
      <th>6268</th>
      <td>1</td>
    </tr>
    <tr>
      <th>6269</th>
      <td>1</td>
    </tr>
    <tr>
      <th>6365</th>
      <td>1</td>
    </tr>
    <tr>
      <th>6385</th>
      <td>1</td>
    </tr>
    <tr>
      <th>6565</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>100004 rows × 1 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-eef6f178-d4f8-4607-b632-043fad289764')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-eef6f178-d4f8-4607-b632-043fad289764 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-eef6f178-d4f8-4607-b632-043fad289764');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell code" data-execution_count="16" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="d1E2i5rZvOOI" data-outputId="1cb8ed1e-2cc7-44ae-ec20-e1b815c43d95">
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>rating.groupby([<span class="st">&#39;userId&#39;</span>, <span class="st">&#39;movieId&#39;</span>]).count()[<span class="st">&#39;rating&#39;</span>].<span class="bu">sum</span>()</span></code></pre></div>
<div class="output execute_result" data-execution_count="16">
<pre><code>100004</code></pre>
</div>
</div>
<div class="cell markdown" id="ynCEs7q3vOOI">
<p>The sum of ratings is equal to the total number of ratings. This implies that there is only one interaction between a pair of items and a user.</p>
</div>
<section id="q-15-which-is-the-most-interacted-movie-in-the-dataset-1-mark" class="cell markdown" id="JQgjqRnevOOI">
<h3><strong>Q 1.5 Which is the most interacted movie in the dataset? (1 Mark)</strong></h3>
</section>
<div class="cell code" data-execution_count="17" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="4LBbXdoDvOOI" data-outputId="373c5080-b0dd-4eb7-c05c-8c8a6c05bef8">
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______ and complete the code</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>rating[<span class="st">&#39;movieId&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="17">
<pre><code>356       341
296       324
318       311
593       304
260       291
         ... 
98604       1
103659      1
104419      1
115927      1
6425        1
Name: movieId, Length: 9066, dtype: int64</code></pre>
</div>
</div>
<div class="cell markdown" id="PSo-c_XAvOOI">
<p>The movie with the ID 356 is the most interacted-with movie in the dataset.</p>
</div>
<div class="cell code" data-execution_count="18" data-colab="{&quot;height&quot;:448,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="fVkc1FK22N9r" data-outputId="ff72dc56-9aa2-42fa-aa28-567bb604ed24">
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting distributions of ratings for 341 interactions with movieid 356 </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">7</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>rating[rating[<span class="st">&#39;movieId&#39;</span>] <span class="op">==</span> <span class="dv">356</span>][<span class="st">&#39;rating&#39;</span>].value_counts().plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Rating&#39;</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/727e196128f88462b72943c4a8dbe273a53d25dd.png" /></p>
</div>
</div>
<div class="cell markdown" id="0pQn17ro2N9s">
<p>This movie appears to be popular in a positive way, as a relatively high proportion of its ratings are 4.0 or 5.0 relative to the average of the whole data set.</p>
</div>
<section id="q-16-which-user-interacted-the-most-with-any-movie-in-the-dataset-1-mark" class="cell markdown" id="0kXJ_iTEvOOI">
<h3><strong>Q 1.6 Which user interacted the most with any movie in the dataset? (1 Mark)</strong></h3>
</section>
<div class="cell code" data-execution_count="19" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="t7ehlMLDvOOI" data-outputId="e9e080d0-fd87-438d-e59f-d884c1d93ccf">
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______ and complete the code</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>rating[<span class="st">&#39;userId&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="19">
<pre><code>547    2391
564    1868
624    1735
15     1700
73     1610
       ... 
296      20
289      20
249      20
221      20
1        20
Name: userId, Length: 671, dtype: int64</code></pre>
</div>
</div>
<div class="cell markdown" id="W-Sdna2ovOOI">
<p>The user with the ID 547 interacted the most with movies in the dataset.</p>
</div>
<section id="q-17-what-is-the-distribution-of-the-user-movie-interactions-in-this-dataset-1-mark" class="cell markdown" id="lHReghdivOOI">
<h3><strong>Q 1.7 What is the distribution of the user-movie interactions in this dataset? (1 Mark)</strong></h3>
</section>
<div class="cell code" data-execution_count="20" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="0XArWJ7l2N9v" data-outputId="2346a04c-951e-4c13-db94-8b0fa9a0dfe7">
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding user-movie interactions distribution</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>count_interactions <span class="op">=</span> rating.groupby(<span class="st">&#39;userId&#39;</span>).count()[<span class="st">&#39;movieId&#39;</span>]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>count_interactions</span></code></pre></div>
<div class="output execute_result" data-execution_count="20">
<pre><code>userId
1       20
2       76
3       51
4      204
5      100
      ... 
667     68
668     20
669     37
670     31
671    115
Name: movieId, Length: 671, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="23" data-colab="{&quot;height&quot;:445,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="JoNCRm88vOOI" data-outputId="2d02bc8b-852e-46b1-d57e-18d5dc41f555">
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting user-movie interactions distribution</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>sns.histplot(count_interactions)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Number of Interactions by Users&#39;</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/6170cd2edc6e0333998521650f0c6488c83766af.png" /></p>
</div>
</div>
<div class="cell markdown" id="vmj5nPiN2N9w">
<p>The distribution is highly skewed right. Very few users interacted with more than 50 movies.</p>
</div>
<div class="cell markdown" id="knK9ML0bwIBR">
<h4 id="as-we-have-now-explored-the-data-lets-start-building-recommendation-systems">As we have now explored the data, let's start building Recommendation systems</h4>
<h2 id="question-2-create-rank-based-recommendation-system-3-marks"><strong>Question 2: Create Rank-Based Recommendation System (3 Marks)</strong></h2>
</div>
<section id="model-1-rank-based-recommendation-system" class="cell markdown" id="CqFN5jDJvOOJ">
<h3><strong>Model 1: Rank-Based Recommendation System</strong></h3>
</section>
<div class="cell markdown" id="W26vIRn1vOOJ">
<p>Rank-based recommendation systems provide recommendations based on the most popular items. This kind of recommendation system is useful when we have <strong>cold start</strong> problems. Cold start refers to the issue when we get a new user into the system and the machine is not able to recommend movies to the new user, as the user did not have any historical interactions in the dataset. In those cases, we can use rank-based recommendation system to recommend movies to the new user.</p>
</div>
<div class="cell markdown" id="I3t4uyGlvOOK">
<p>To build the rank-based recommendation system, we take <strong>average</strong> of all the ratings provided to each movie and then rank them based on their average rating.</p>
</div>
<div class="cell code" data-execution_count="24" id="xuMR3XFIvOOK">
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______ and complete the code</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating average ratings</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>average_rating <span class="op">=</span> rating.groupby(<span class="st">&#39;movieId&#39;</span>).mean()[<span class="st">&#39;rating&#39;</span>]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating the count of ratings</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>count_rating <span class="op">=</span> rating.groupby(<span class="st">&#39;movieId&#39;</span>).count()[<span class="st">&#39;rating&#39;</span>]</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Making a dataframe with the count and average of ratings</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>final_rating <span class="op">=</span> pd.DataFrame({<span class="st">&#39;avg_rating&#39;</span>:average_rating, <span class="st">&#39;rating_count&#39;</span>:count_rating})</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="25" data-colab="{&quot;height&quot;:238,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="J6NLX6FIvOOK" data-outputId="7d1e8a9b-c8dd-43ee-e22e-ff0258a1697b">
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>final_rating.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="25">

  <div id="df-866460ba-76b0-4b42-9bc0-b33d9240dd6e">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>avg_rating</th>
      <th>rating_count</th>
    </tr>
    <tr>
      <th>movieId</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>3.872470</td>
      <td>247</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.401869</td>
      <td>107</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.161017</td>
      <td>59</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.384615</td>
      <td>13</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3.267857</td>
      <td>56</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-866460ba-76b0-4b42-9bc0-b33d9240dd6e')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-866460ba-76b0-4b42-9bc0-b33d9240dd6e button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-866460ba-76b0-4b42-9bc0-b33d9240dd6e');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell markdown" id="Pv31nHm_2N9y">
<p>Now, let's create a function to find the <strong>top n movies</strong> for a recommendation based on the average ratings of movies. We can also add a <strong>threshold for a minimum number of interactions</strong> for a movie to be considered for recommendation.</p>
</div>
<div class="cell code" data-execution_count="27" id="Fy0SbxnevOOK">
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> top_n_movies(data, n, min_interaction<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Finding movies with minimum number of interactions</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    recommendations <span class="op">=</span> data[data[<span class="st">&#39;rating_count&#39;</span>] <span class="op">&gt;=</span> min_interaction]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Sorting values w.r.t average rating </span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    recommendations <span class="op">=</span> recommendations.sort_values(by<span class="op">=</span><span class="st">&#39;avg_rating&#39;</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> recommendations.index[:n]</span></code></pre></div>
</div>
<div class="cell markdown" id="fi9vhL4Z2N9y">
<p>We can <strong>use this function with different n's and minimum interactions</strong> to get movies to recommend</p>
</div>
<section id="recommending-top-5-movies-with-50-minimum-interactions-based-on-popularity" class="cell markdown" id="hkz4LlTpvOOK">
<h4><strong>Recommending top 5 movies with 50 minimum interactions based on popularity</strong></h4>
</section>
<div class="cell code" data-execution_count="28" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="u-JX_ES9vOOK" data-outputId="2ea0c319-9185-4d8f-bb74-eec92d73b682">
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______ and complete the code</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(top_n_movies(final_rating, <span class="dv">5</span>, <span class="dv">50</span>))</span></code></pre></div>
<div class="output execute_result" data-execution_count="28">
<pre><code>[858, 318, 969, 913, 1221]</code></pre>
</div>
</div>
<section id="recommending-top-5-movies-with-100-minimum-interactions-based-on-popularity" class="cell markdown" id="KRFTrsBVvOOK">
<h4><strong>Recommending top 5 movies with 100 minimum interactions based on popularity</strong></h4>
</section>
<div class="cell code" data-execution_count="29" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="U2wvxF2rvOOK" data-outputId="81a4717e-f7ee-471a-9ac9-cec85d2e0d52">
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______ and complete the code</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(top_n_movies(final_rating, <span class="dv">5</span>, <span class="dv">100</span>))</span></code></pre></div>
<div class="output execute_result" data-execution_count="29">
<pre><code>[858, 318, 1221, 50, 527]</code></pre>
</div>
</div>
<section id="recommending-top-5-movies-with-200-minimum-interactions-based-on-popularity" class="cell markdown" id="_3SW8bLkvOOK">
<h4><strong>Recommending top 5 movies with 200 minimum interactions based on popularity</strong></h4>
</section>
<div class="cell code" data-execution_count="30" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="t6ziQvDgvOOK" data-outputId="af8b4c1f-9e12-449e-f149-38abf85739c4">
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______ and complete the code</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(top_n_movies(final_rating, <span class="dv">5</span>, <span class="dv">200</span>))</span></code></pre></div>
<div class="output execute_result" data-execution_count="30">
<pre><code>[858, 318, 50, 527, 608]</code></pre>
</div>
</div>
<div class="cell markdown" id="r4vrsunx2N91">
<p>Now that we have seen <strong>how to apply the Rank-Based Recommendation System</strong>, let's apply the <strong>Collaborative Filtering Based Recommendation Systems</strong>.</p>
</div>
<section id="model-2-user-based-collaborative-filtering-recommendation-system-7-marks" class="cell markdown" id="sJI5kiiGvOOK">
<h2><strong>Model 2: User based Collaborative Filtering Recommendation System (7 Marks)</strong></h2>
</section>
<div class="cell markdown" id="wVjPUvj82N92">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/85319b4d763f981ed9401685dcfcba5b9d9158ee.png" alt="collaborative_filtering.PNG" /></p>
</div>
<div class="cell markdown" id="H4yaWX37vOOK">
<p>In the above <strong>interactions matrix</strong>, out of users B and C, which user is most likely to interact with the movie, "The Terminal"?</p>
</div>
<div class="cell markdown" id="QoSujZuuvOOK">
<p>In this type of recommendation system, <code>we do not need any information</code> about the users or items. We only need user item interaction data to build a collaborative recommendation system. For example - <ol> <li><b>Ratings</b> provided by users. For example - ratings of books on goodread, movie ratings on imdb etc</li> <li><b>Likes</b> of users on different facebook posts, likes on youtube videos</li> <li><b>Use/buying</b> of a product by users. For example - buying different items on e-commerce sites</li> <li><b>Reading</b> of articles by readers on various blogs</li> </ol></p>
</div>
<div class="cell markdown" id="A_3GtPzuvOOK">
<p><strong>Types of Collaborative Filtering</strong></p>
</div>
<div class="cell markdown" id="igZX3WbqvOOK">
<ul>
<li><p>Similarity/Neighborhood based</p></li>
<li><p>User-User Similarity Based<br />
</p></li>
<li><p>Item-Item similarity based</p></li>
<li><p>Model based</p></li>
</ul>
</div>
<section id="building-similarityneighborhood-based-collaborative-filtering" class="cell markdown" id="0D3MuFHqvOOK">
<h4><strong>Building Similarity/Neighborhood based Collaborative Filtering</strong></h4>
</section>
<div class="cell markdown" id="vyCEv8eJvOOK">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/de4b023e5b167c6706b2c94b9b600b8b8ead81b0.png" alt="test_image" /></p>
</div>
<section id="building-a-baseline-user-user-similarity-based-recommendation-system" class="cell markdown" id="skzc0N1_nVNB">
<h3><strong>Building a baseline user-user similarity based recommendation system</strong></h3>
</section>
<div class="cell markdown" id="d4Uo_MYMnVNB">
<ul>
<li>Below, we are building <strong>similarity-based recommendation systems</strong> using <code>cosine</code> similarity and using <strong>KNN to find similar users</strong> which are the nearest neighbor to the given user.<br />
</li>
<li>We will be using a new library, called <code>surprise</code>, to build the remaining models. Let's first import the necessary classes and functions from this library.</li>
</ul>
</div>
<div class="cell markdown" id="8hxjJMTwnVNB">
<p>Below we are loading the <strong><code>rating</code> dataset</strong>, which is a <strong>pandas DataFrame</strong>, into a <strong>different format called <code>surprise.dataset.DatasetAutoFolds</code></strong>, which is required by this library. To do this, we will be <strong>using the classes <code>Reader</code> and <code>Dataset</code></strong>. Finally splitting the data into train and test set.</p>
</div>
<section id="making-the-dataset-into-surprise-dataset-and-splitting-it-into-train-and-test-set" class="cell markdown" id="n3PpFZlW0q_d">
<h4><strong>Making the dataset into surprise dataset and splitting it into train and test set</strong></h4>
</section>
<div class="cell code" data-execution_count="31" id="rGfYDiOCpe4X">
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiating Reader scale with expected rating scale</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>reader <span class="op">=</span> Reader(rating_scale<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">5</span>))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the rating dataset</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> Dataset.load_from_df(rating[[<span class="st">&#39;userId&#39;</span>, <span class="st">&#39;movieId&#39;</span>, <span class="st">&#39;rating&#39;</span>]], reader)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into train and test dataset</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>trainset, testset <span class="op">=</span> train_test_split(data, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code></pre></div>
</div>
<section id="build-the-first-baseline-similarity-based-recommendation-system-using-cosine-similarity-and-knn" class="cell markdown" id="DmHTEt7TnVNC">
<h4><strong>Build the first baseline similarity based recommendation system using cosine similarity and KNN</strong></h4>
</section>
<div class="cell code" data-execution_count="33" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="vO3FL7iape8A" data-outputId="33b3448e-b6a9-411f-e5c1-ad69be49246f">
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______ and complete the code</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>sim_options <span class="op">=</span> {<span class="st">&#39;name&#39;</span>: <span class="st">&#39;cosine&#39;</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;user_based&#39;</span>: <span class="va">True</span>}</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining Nearest neighbour algorithm</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>algo_knn_user <span class="op">=</span> KNNBasic(sim_options<span class="op">=</span>sim_options,verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the algorithm on the trainset or fitting the model on train dataset </span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>algo_knn_user.fit(trainset)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict ratings for the testset</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> algo_knn_user.test(testset)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Then compute RMSE</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>accuracy.rmse(predictions)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>RMSE: 0.9925
</code></pre>
</div>
<div class="output execute_result" data-execution_count="33">
<pre><code>0.9924509041520163</code></pre>
</div>
</div>
<section id="q-31-what-is-the-rmse-for-baseline-user-based-collaborative-filtering-recommendation-system-1-mark" class="cell markdown" id="6y7zChf8wIBr">
<h3><strong>Q 3.1 What is the RMSE for baseline user based collaborative filtering recommendation system? (1 Mark)</strong></h3>
</section>
<div class="cell markdown" id="yE5kvdZenVNC">
<p>The RMSE for the baseline system is 0.<strong>9925</strong>.</p>
</div>
<section id="q-32-what-is-the-predicted-rating-for-an-user-with-userid4-and-for-movieid10-and-movieid3-1-mark" class="cell markdown" id="qelE7GyrwIBs">
<h3><strong>Q 3.2 What is the Predicted rating for an user with userId=4 and for movieId=10 and movieId=3? (1 Mark)</strong></h3>
</section>
<div class="cell markdown" id="reFD0-nsnVNC">
<p>Let's us now predict rating for an user with <code>userId=4</code> and for <code>movieId=10</code></p>
</div>
<div class="cell code" data-execution_count="36" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="Sxd23bZ9pe_x" data-outputId="e69638d5-b446-480d-fc0f-99a80162e3e4">
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>algo_knn_user.predict(<span class="dv">4</span>, <span class="dv">10</span>, r_ui<span class="op">=</span><span class="dv">4</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>user: 4          item: 10         r_ui = 4.00   est = 3.62   {&#39;actual_k&#39;: 40, &#39;was_impossible&#39;: False}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="36">
<pre><code>Prediction(uid=4, iid=10, r_ui=4, est=3.6244912065910952, details={&#39;actual_k&#39;: 40, &#39;was_impossible&#39;: False})</code></pre>
</div>
</div>
<div class="cell markdown" id="QuVbIR3SnVNE">
<p>Movie 10 has an estimated rating of <strong>3.62</strong> for user 4.</p>
</div>
<div class="cell markdown" id="EXSgq8OEnVNE">
<p>Let's predict the rating for the same <code>userId=4</code> but for a movie which this user has not interacted before i.e. <code>movieId=3</code></p>
</div>
<div class="cell code" data-execution_count="37" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="PbFcBj1PpfEV" data-outputId="93ea19a1-2ab2-4c21-afcd-f15cf2582b25">
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>algo_knn_user.predict(<span class="dv">4</span>, <span class="dv">3</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>user: 4          item: 3          r_ui = None   est = 3.20   {&#39;actual_k&#39;: 40, &#39;was_impossible&#39;: False}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="37">
<pre><code>Prediction(uid=4, iid=3, r_ui=None, est=3.202703552548654, details={&#39;actual_k&#39;: 40, &#39;was_impossible&#39;: False})</code></pre>
</div>
</div>
<div class="cell markdown" id="cm2xqtcQnVNE">
<p>Movie 3 has an estimated rating of <strong>3.20</strong> for user 4.</p>
</div>
<section id="improving-user-user-similarity-based-recommendation-system-by-tuning-its-hyper-parameters" class="cell markdown" id="ejjof6csnVNF">
<h3><strong>Improving user-user similarity based recommendation system by tuning its hyper-parameters</strong></h3>
</section>
<div class="cell markdown" id="x_kxe-_JnVNF">
<p>Below we will be tuning hyper-parmeters for the <code>KNNBasic</code> algorithms. Let's try to understand different hyperparameters of KNNBasic algorithm -</p>
</div>
<div class="cell markdown" id="p2j4VvfQnVNF">
<ul>
<li><strong>k</strong> (int) – The (max) number of neighbors to take into account for aggregation (see this note). Default is 40.</li>
<li><strong>min_k</strong> (int) – The minimum number of neighbors to take into account for aggregation. If there are not enough neighbors, the prediction is set to the global mean of all ratings. Default is 1.</li>
<li><strong>sim_options</strong> (dict) – A dictionary of options for the similarity measure. And there are four similarity measures available in surprise -
<ul>
<li>cosine</li>
<li>msd (default)</li>
<li>pearson</li>
<li>pearson baseline</li>
</ul></li>
</ul>
<p>For more details please refer the official documentation <a href="https://surprise.readthedocs.io/en/stable/knn_inspired.html" class="uri">https://surprise.readthedocs.io/en/stable/knn_inspired.html</a></p>
</div>
<section id="q-33-perform-hyperparameter-tuning-for-the-baseline-user-based-collaborative-filtering-recommendation-system-and-find-the-rmse-for-tuned-user-based-collaborative-filtering-recommendation-system-3-marks" class="cell markdown" id="lTLnYn_JwIBx">
<h3><strong>Q 3.3 Perform hyperparameter tuning for the baseline user based collaborative filtering recommendation system and find the RMSE for tuned user based collaborative filtering recommendation system? (3 Marks)</strong></h3>
</section>
<div class="cell code" data-execution_count="38" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="KpGhU15gpfHg" data-outputId="95e38fdc-fb04-4c74-ed02-f8aa1d2b3192">
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______ and complete the code</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting up parameter grid to tune the hyperparameters</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">&#39;k&#39;</span>: [<span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>], <span class="st">&#39;min_k&#39;</span>: [<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>],</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;sim_options&#39;</span>: {<span class="st">&#39;name&#39;</span>: [<span class="st">&#39;msd&#39;</span>, <span class="st">&#39;cosine&#39;</span>],</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&#39;user_based&#39;</span>: [<span class="va">True</span>]}</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Performing 3-fold cross validation to tune the hyperparameters</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>grid_obj <span class="op">=</span> GridSearchCV(KNNBasic, param_grid, measures<span class="op">=</span>[<span class="st">&#39;rmse&#39;</span>, <span class="st">&#39;mae&#39;</span>], cv<span class="op">=</span><span class="dv">3</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting the data</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>grid_obj.fit(data)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Best RMSE score</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grid_obj.best_score[<span class="st">&#39;rmse&#39;</span>])</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Combination of parameters that gave the best RMSE score</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grid_obj.best_params[<span class="st">&#39;rmse&#39;</span>])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>0.9652553929644568
{&#39;k&#39;: 20, &#39;min_k&#39;: 3, &#39;sim_options&#39;: {&#39;name&#39;: &#39;msd&#39;, &#39;user_based&#39;: True}}
</code></pre>
</div>
</div>
<div class="cell markdown" id="L2fHNvu7nVNF">
<p>Once the grid search is <strong>complete</strong>, we can get the <strong>optimal values for each of those hyperparameters</strong> as shown above.</p>
</div>
<div class="cell markdown" id="h_K6yd6XnVNF">
<p>Below we are analysing evaluation metrics - RMSE and MAE at each and every split to analyze the impact of each value of hyperparameters</p>
</div>
<div class="cell code" data-execution_count="39" data-colab="{&quot;height&quot;:531,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="TzJxk_Z4q1A8" data-outputId="019f7887-3a73-4e84-f120-9a87fe90e5d0">
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> pd.DataFrame.from_dict(grid_obj.cv_results)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>results_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="39">

  <div id="df-fda9b64d-9847-4b68-aec4-63c93fa97108">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe {
      max-width: 36rem;
      overflow: scroll;
    }
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>split0_test_rmse</th>
      <th>split1_test_rmse</th>
      <th>split2_test_rmse</th>
      <th>mean_test_rmse</th>
      <th>std_test_rmse</th>
      <th>rank_test_rmse</th>
      <th>split0_test_mae</th>
      <th>split1_test_mae</th>
      <th>split2_test_mae</th>
      <th>mean_test_mae</th>
      <th>std_test_mae</th>
      <th>rank_test_mae</th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_test_time</th>
      <th>std_test_time</th>
      <th>params</th>
      <th>param_k</th>
      <th>param_min_k</th>
      <th>param_sim_options</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.965568</td>
      <td>0.961561</td>
      <td>0.968637</td>
      <td>0.965255</td>
      <td>0.002897</td>
      <td>1</td>
      <td>0.744661</td>
      <td>0.738655</td>
      <td>0.743292</td>
      <td>0.742203</td>
      <td>0.002570</td>
      <td>1</td>
      <td>0.129260</td>
      <td>0.006148</td>
      <td>3.364002</td>
      <td>0.037595</td>
      <td>{'k': 20, 'min_k': 3, 'sim_options': {'name': ...</td>
      <td>20</td>
      <td>3</td>
      <td>{'name': 'msd', 'user_based': True}</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.994451</td>
      <td>0.992335</td>
      <td>0.996891</td>
      <td>0.994559</td>
      <td>0.001861</td>
      <td>14</td>
      <td>0.770900</td>
      <td>0.766768</td>
      <td>0.769493</td>
      <td>0.769054</td>
      <td>0.001715</td>
      <td>12</td>
      <td>0.743921</td>
      <td>0.021103</td>
      <td>3.064117</td>
      <td>0.138485</td>
      <td>{'k': 20, 'min_k': 3, 'sim_options': {'name': ...</td>
      <td>20</td>
      <td>3</td>
      <td>{'name': 'cosine', 'user_based': True}</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.970929</td>
      <td>0.965168</td>
      <td>0.971683</td>
      <td>0.969260</td>
      <td>0.002910</td>
      <td>4</td>
      <td>0.748282</td>
      <td>0.741616</td>
      <td>0.745940</td>
      <td>0.745279</td>
      <td>0.002761</td>
      <td>3</td>
      <td>0.113563</td>
      <td>0.005318</td>
      <td>3.041815</td>
      <td>0.100373</td>
      <td>{'k': 20, 'min_k': 6, 'sim_options': {'name': ...</td>
      <td>20</td>
      <td>6</td>
      <td>{'name': 'msd', 'user_based': True}</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.998277</td>
      <td>0.994462</td>
      <td>0.998090</td>
      <td>0.996943</td>
      <td>0.001756</td>
      <td>15</td>
      <td>0.773384</td>
      <td>0.768445</td>
      <td>0.770557</td>
      <td>0.770795</td>
      <td>0.002023</td>
      <td>15</td>
      <td>0.665888</td>
      <td>0.040078</td>
      <td>3.042022</td>
      <td>0.025506</td>
      <td>{'k': 20, 'min_k': 6, 'sim_options': {'name': ...</td>
      <td>20</td>
      <td>6</td>
      <td>{'name': 'cosine', 'user_based': True}</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.975982</td>
      <td>0.970484</td>
      <td>0.978132</td>
      <td>0.974866</td>
      <td>0.003220</td>
      <td>7</td>
      <td>0.752162</td>
      <td>0.746114</td>
      <td>0.751751</td>
      <td>0.750009</td>
      <td>0.002759</td>
      <td>6</td>
      <td>0.123360</td>
      <td>0.019757</td>
      <td>3.219795</td>
      <td>0.086318</td>
      <td>{'k': 20, 'min_k': 9, 'sim_options': {'name': ...</td>
      <td>20</td>
      <td>9</td>
      <td>{'name': 'msd', 'user_based': True}</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-fda9b64d-9847-4b68-aec4-63c93fa97108')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-fda9b64d-9847-4b68-aec4-63c93fa97108 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-fda9b64d-9847-4b68-aec4-63c93fa97108');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell markdown" id="NHWgxu_YnVNG">
<p>Now, let's build the <strong>final model by using tuned values of the hyperparameters</strong>, which we received by using <strong>grid search cross-validation</strong>.</p>
</div>
<div class="cell code" data-execution_count="41" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="PujRJA8X_JEJ" data-outputId="19af9dc6-14fa-4ce2-c3c3-dbd0bf2fa5cd">
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the optimal similarity measure for user-user based collaborative filtering</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating an instance of KNNBasic with optimal hyperparameter values</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>similarity_algo_optimized_user <span class="op">=</span> KNNBasic(sim_options <span class="op">=</span> sim_options, k<span class="op">=</span><span class="dv">40</span>, min_k<span class="op">=</span><span class="dv">6</span>,verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Training the algorithm on the trainset</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>similarity_algo_optimized_user.fit(trainset)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting ratings for the testset</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> similarity_algo_optimized_user.test(testset)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing RMSE on testset</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>accuracy.rmse(predictions)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>RMSE: 0.9908
</code></pre>
</div>
<div class="output execute_result" data-execution_count="41">
<pre><code>0.9907613369496804</code></pre>
</div>
</div>
<div class="cell markdown" id="YA37vQ6qnVNG">
<p>We can see from above that after tuning hyperparameters, <strong>RMSE for testset has reduced to 0.98 from 0.9925</strong>. Thus, hyperparameter tuning has slightly improved our model.</p>
</div>
<section id="q-34-what-is-the-predicted-rating-for-an-user-with-userid-4-and-for-movieid-10-and-movieid3-using-tuned-user-based-collaborative-filtering-1-mark" class="cell markdown" id="3gZQybgVwIB1">
<h3><strong>Q 3.4 What is the Predicted rating for an user with userId =4 and for movieId= 10 and movieId=3 using tuned user based collaborative filtering? (1 Mark)</strong></h3>
</section>
<div class="cell markdown" id="YhcAXK0CnVNG">
<p>Let's us now predict rating for an user with <code>userId=4</code> and for <code>movieId=10</code> with the optimized model</p>
</div>
<div class="cell code" data-execution_count="42" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="FgV63lHiq1TV" data-outputId="0fa354ba-01c5-461f-fad4-de8099345fe6">
<div class="sourceCode" id="cb54"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______ and complete the code</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>similarity_algo_optimized_user.predict(<span class="dv">4</span>,<span class="dv">10</span>, r_ui<span class="op">=</span><span class="dv">4</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>user: 4          item: 10         r_ui = 4.00   est = 3.62   {&#39;actual_k&#39;: 40, &#39;was_impossible&#39;: False}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="42">
<pre><code>Prediction(uid=4, iid=10, r_ui=4, est=3.6244912065910952, details={&#39;actual_k&#39;: 40, &#39;was_impossible&#39;: False})</code></pre>
</div>
</div>
<div class="cell markdown" id="AMBeqeUtnVNG">
<p>The predicted rating for the optimized algorithm is <strong>still</strong> <strong>3.62</strong>.</p>
</div>
<div class="cell markdown" id="P1JLqz6mnVNH">
<p>Below we are predicting rating for the same <code>userId=4</code> but for a movie which this user has not interacted before i.e. <code>movieId=3</code>, by using the optimized model as shown below -</p>
</div>
<div class="cell code" data-execution_count="43" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="HXO2Ztjhq1bN" data-outputId="2b48264e-fe1c-416a-b6e8-12fa6a324360">
<div class="sourceCode" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______ and complete the code</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>similarity_algo_optimized_user.predict(<span class="dv">4</span>,<span class="dv">3</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>user: 4          item: 3          r_ui = None   est = 3.20   {&#39;actual_k&#39;: 40, &#39;was_impossible&#39;: False}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="43">
<pre><code>Prediction(uid=4, iid=3, r_ui=None, est=3.202703552548654, details={&#39;actual_k&#39;: 40, &#39;was_impossible&#39;: False})</code></pre>
</div>
</div>
<div class="cell markdown" id="PN_tYvepnVNH">
<p>The predicted rating for the optimized algorithm is <strong>still</strong> <strong>3.20</strong>.</p>
</div>
<section id="identifying-similar-users-to-a-given-user-nearest-neighbors" class="cell markdown" id="o2QsfqhanVNH">
<h3><strong>Identifying similar users to a given user (nearest neighbors)</strong></h3>
<p>We can also find out the similar users to a given user or its nearest neighbors based on this KNNBasic algorithm. Below we are finding 5 most similar user to the <code>userId=4</code> based on the <code>msd</code> distance metric</p>
</section>
<div class="cell code" data-execution_count="44" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="evkmTb6P5HYO" data-outputId="61cd9b41-b1bc-4420-9573-9bd97c54ec24">
<div class="sourceCode" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>similarity_algo_optimized_user.get_neighbors(<span class="dv">4</span>, k<span class="op">=</span><span class="dv">5</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="44">
<pre><code>[357, 220, 590, 491, 647]</code></pre>
</div>
</div>
<section id="implementing-the-recommendation-algorithm-based-on-optimized-knnbasic-model" class="cell markdown" id="Z0NsrX_anVNH">
<h3><strong>Implementing the recommendation algorithm based on optimized KNNBasic model</strong></h3>
</section>
<div class="cell markdown" id="U3ESobDynVNI">
<p>Below we will be implementing a function where the input parameters are -</p>
<ul>
<li>data: a rating dataset</li>
<li>user_id: an user id against which we want the recommendations</li>
<li>top_n: the number of movies we want to recommend</li>
<li>algo: the algorithm we want to use to predict the ratings</li>
</ul>
</div>
<div class="cell code" data-execution_count="45" id="vW9V1Tk65HlY">
<div class="sourceCode" id="cb62"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_recommendations(data, user_id, top_n, algo):</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Creating an empty list to store the recommended movie ids</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    recommendations <span class="op">=</span> []</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Creating an user item interactions matrix </span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    user_item_interactions_matrix <span class="op">=</span> data.pivot(index<span class="op">=</span><span class="st">&#39;userId&#39;</span>, columns<span class="op">=</span><span class="st">&#39;movieId&#39;</span>, values<span class="op">=</span><span class="st">&#39;rating&#39;</span>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extracting those movie ids which the user_id has not interacted yet</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    non_interacted_movies <span class="op">=</span> user_item_interactions_matrix.loc[user_id][user_item_interactions_matrix.loc[user_id].isnull()].index.tolist()</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Looping through each of the movie id which user_id has not interacted yet</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item_id <span class="kw">in</span> non_interacted_movies:</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predicting the ratings for those non interacted movie ids by this user</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>        est <span class="op">=</span> algo.predict(user_id, item_id).est</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Appending the predicted ratings</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>        recommendations.append((item_id, est))</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sorting the predicted ratings in descending order</span></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>    recommendations.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> recommendations[:top_n] <span class="co"># returing top n highest predicted rating movies for this user</span></span></code></pre></div>
</div>
<section id="predicted-top-5-movies-for-userid4-with-similarity-based-recommendation-system" class="cell markdown" id="Oj_S7kh4nVNI">
<h4><strong>Predicted top 5 movies for userId=4 with similarity based recommendation system</strong></h4>
</section>
<div class="cell code" data-execution_count="47" id="qWbR85mI5Hrk">
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>recommendations <span class="op">=</span> get_recommendations(rating,<span class="dv">4</span>,<span class="dv">5</span>,similarity_algo_optimized_user)</span></code></pre></div>
</div>
<section id="q-35-predict-the-top-5-movies-for-userid4-with-similarity-based-recommendation-system-1-mark" class="cell markdown" id="33GchLEiwICA">
<h3><strong>Q 3.5 Predict the top 5 movies for userId=4 with similarity based recommendation system (1 Mark)</strong></h3>
</section>
<div class="cell code" data-execution_count="48" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="b5WfIX0Z6_q2" data-outputId="5c10fee1-304a-46eb-badf-832370580d65">
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>recommendations</span></code></pre></div>
<div class="output execute_result" data-execution_count="48">
<pre><code>[(98491, 4.832340578646058),
 (116, 4.753206589295344),
 (6669, 4.748048450384675),
 (1221, 4.662571141751736),
 (1192, 4.65824768595177)]</code></pre>
</div>
</div>
<section id="model-3-item-based-collaborative-filtering-recommendation-system-7-marks" class="cell markdown" id="pqm4J6aQwICB">
<h2><strong>Model 3: Item based Collaborative Filtering Recommendation System (7 Marks)</strong></h2>
</section>
<div class="cell code" data-execution_count="50" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="fa8W64l5wICB" data-outputId="02ffc6ec-af7b-4775-ec5c-30e76354a1e5">
<div class="sourceCode" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definfing similarity measure</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>sim_options <span class="op">=</span> {<span class="st">&#39;name&#39;</span>: <span class="st">&#39;cosine&#39;</span>,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;user_based&#39;</span>: <span class="va">False</span>}</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining Nearest neighbour algorithm</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>algo_knn_item <span class="op">=</span> KNNBasic(sim_options<span class="op">=</span>sim_options, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the algorithm on the trainset or fitting the model on train dataset </span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>algo_knn_item.fit(trainset)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict ratings for the testset</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> algo_knn_item.test(testset)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Then compute RMSE</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>accuracy.rmse(predictions)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>RMSE: 1.0032
</code></pre>
</div>
<div class="output execute_result" data-execution_count="50">
<pre><code>1.003221450633729</code></pre>
</div>
</div>
<section id="q-41-what-is-the-rmse-for-baseline-item-based-collaborative-filtering-recommendation-system-1-mark" class="cell markdown" id="oW6HXjoVwICC">
<h3><strong>Q 4.1 What is the RMSE for baseline item based collaborative filtering recommendation system ?(1 Mark)</strong></h3>
</section>
<div class="cell markdown" id="dsagkpFDwICD">
<p>The baseline item-based system has an RMSE of <strong>1.0032</strong>.</p>
</div>
<div class="cell markdown" id="uXRReHXt2UD8">
<p>Let's us now predict rating for an user with <code>userId=4</code> and for <code>movieId=10</code></p>
</div>
<section id="q-42-what-is-the-predicted-rating-for-an-user-with-userid-4-and-for-movieid-10-and-movieid3-1-mark" class="cell markdown" id="egyW6VMYwICD">
<h3><strong>Q 4.2 What is the Predicted rating for an user with userId =4 and for movieId= 10 and movieId=3? (1 Mark)</strong></h3>
</section>
<div class="cell code" data-execution_count="51" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="RmzxmaDbwICE" data-outputId="06c6b741-5547-4b3c-e3a2-6ed015ed4a94" data-scrolled="true">
<div class="sourceCode" id="cb69"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>algo_knn_item.predict(<span class="dv">4</span>,<span class="dv">10</span>, r_ui<span class="op">=</span><span class="dv">4</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>user: 4          item: 10         r_ui = 4.00   est = 4.37   {&#39;actual_k&#39;: 40, &#39;was_impossible&#39;: False}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="51">
<pre><code>Prediction(uid=4, iid=10, r_ui=4, est=4.373794871885004, details={&#39;actual_k&#39;: 40, &#39;was_impossible&#39;: False})</code></pre>
</div>
</div>
<div class="cell markdown" id="fyPeJdK6wICF">
<p>The system predicts a rating of <strong>4.37</strong> for user 4 for movie 10.</p>
</div>
<div class="cell markdown" id="CTSx7Wl5wICG">
<p>Let's predict the rating for the same <code>userId=4</code> but for a movie which this user has not interacted before i.e. <code>movieId=3</code></p>
</div>
<div class="cell code" data-execution_count="52" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="-l8G1XG5wICG" data-outputId="8d44e571-09f9-41bf-fd72-0592b6e2d311">
<div class="sourceCode" id="cb72"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>algo_knn_item.predict(<span class="dv">4</span>,<span class="dv">3</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>user: 4          item: 3          r_ui = None   est = 4.07   {&#39;actual_k&#39;: 40, &#39;was_impossible&#39;: False}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="52">
<pre><code>Prediction(uid=4, iid=3, r_ui=None, est=4.071601862880049, details={&#39;actual_k&#39;: 40, &#39;was_impossible&#39;: False})</code></pre>
</div>
</div>
<div class="cell markdown" id="WKqI9IyhwICH">
<p>The system predicts a rating of <strong>4.07</strong> for user 4 for movie 3.</p>
</div>
<section id="q-43-perform-hyperparameter-tuning-for-the-baseline-item-based-collaborative-filtering-recommendation-system-and-find-the-rmse-for-tuned-item-based-collaborative-filtering-recommendation-system-3-marks" class="cell markdown" id="utHBZ67JwICI">
<h3><strong>Q 4.3 Perform hyperparameter tuning for the baseline item based collaborative filtering recommendation system and find the RMSE for tuned item based collaborative filtering recommendation system? (3 Marks)</strong></h3>
</section>
<div class="cell code" data-execution_count="53" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="0ZmIvW--wICJ" data-outputId="c59801dd-6290-4121-8cf7-cbd266e2dda2">
<div class="sourceCode" id="cb75"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______ and complete the code</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting up parameter grid to tune the hyperparameters</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">&#39;k&#39;</span>: [<span class="dv">20</span>, <span class="dv">30</span>,<span class="dv">40</span>], <span class="st">&#39;min_k&#39;</span>: [<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>],</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;sim_options&#39;</span>: {<span class="st">&#39;name&#39;</span>: [<span class="st">&#39;msd&#39;</span>, <span class="st">&#39;cosine&#39;</span>],</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&#39;user_based&#39;</span>: [<span class="va">False</span>]}</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Performing 3-fold cross validation to tune the hyperparameters</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>grid_obj <span class="op">=</span> GridSearchCV(KNNBasic, param_grid, measures<span class="op">=</span>[<span class="st">&#39;rmse&#39;</span>, <span class="st">&#39;mae&#39;</span>], cv<span class="op">=</span><span class="dv">3</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting the data</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>grid_obj.fit(data)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Best RMSE score</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grid_obj.best_score[<span class="st">&#39;rmse&#39;</span>])</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Combination of parameters that gave the best RMSE score</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grid_obj.best_params[<span class="st">&#39;rmse&#39;</span>])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>0.9401320571134547
{&#39;k&#39;: 40, &#39;min_k&#39;: 6, &#39;sim_options&#39;: {&#39;name&#39;: &#39;msd&#39;, &#39;user_based&#39;: False}}
</code></pre>
</div>
</div>
<div class="cell markdown" id="_uAej6IMwICK">
<p>Once the <strong>grid search</strong> is complete, we can get the <strong>optimal values for each of those hyperparameters as shown above</strong></p>
</div>
<div class="cell markdown" id="2W3LQWA9wICK">
<p>Below we are analysing evaluation metrics - RMSE and MAE at each and every split to analyze the impact of each value of hyperparameters</p>
</div>
<div class="cell code" data-execution_count="54" data-colab="{&quot;height&quot;:531,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="ITKMae3LwICL" data-outputId="10f27662-2900-4763-c114-74ef14275ddf" data-scrolled="false">
<div class="sourceCode" id="cb77"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> pd.DataFrame.from_dict(grid_obj.cv_results)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>results_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="54">

  <div id="df-f9506578-c167-4dc2-9efe-7e77009d28b5">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>split0_test_rmse</th>
      <th>split1_test_rmse</th>
      <th>split2_test_rmse</th>
      <th>mean_test_rmse</th>
      <th>std_test_rmse</th>
      <th>rank_test_rmse</th>
      <th>split0_test_mae</th>
      <th>split1_test_mae</th>
      <th>split2_test_mae</th>
      <th>mean_test_mae</th>
      <th>std_test_mae</th>
      <th>rank_test_mae</th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_test_time</th>
      <th>std_test_time</th>
      <th>params</th>
      <th>param_k</th>
      <th>param_min_k</th>
      <th>param_sim_options</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.951277</td>
      <td>0.950129</td>
      <td>0.950116</td>
      <td>0.950508</td>
      <td>0.000544</td>
      <td>8</td>
      <td>0.734416</td>
      <td>0.734226</td>
      <td>0.733322</td>
      <td>0.733988</td>
      <td>0.000477</td>
      <td>7</td>
      <td>7.439870</td>
      <td>0.545805</td>
      <td>11.326026</td>
      <td>0.512808</td>
      <td>{'k': 20, 'min_k': 3, 'sim_options': {'name': ...</td>
      <td>20</td>
      <td>3</td>
      <td>{'name': 'msd', 'user_based': False}</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.012004</td>
      <td>1.016567</td>
      <td>1.014096</td>
      <td>1.014222</td>
      <td>0.001865</td>
      <td>17</td>
      <td>0.789165</td>
      <td>0.793400</td>
      <td>0.791117</td>
      <td>0.791227</td>
      <td>0.001731</td>
      <td>16</td>
      <td>20.378437</td>
      <td>1.080052</td>
      <td>10.987197</td>
      <td>0.362469</td>
      <td>{'k': 20, 'min_k': 3, 'sim_options': {'name': ...</td>
      <td>20</td>
      <td>3</td>
      <td>{'name': 'cosine', 'user_based': False}</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.951213</td>
      <td>0.950136</td>
      <td>0.950120</td>
      <td>0.950490</td>
      <td>0.000512</td>
      <td>7</td>
      <td>0.734455</td>
      <td>0.734210</td>
      <td>0.733590</td>
      <td>0.734085</td>
      <td>0.000364</td>
      <td>8</td>
      <td>6.380261</td>
      <td>0.199738</td>
      <td>11.128263</td>
      <td>0.456450</td>
      <td>{'k': 20, 'min_k': 6, 'sim_options': {'name': ...</td>
      <td>20</td>
      <td>6</td>
      <td>{'name': 'msd', 'user_based': False}</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.011952</td>
      <td>1.016582</td>
      <td>1.014071</td>
      <td>1.014202</td>
      <td>0.001892</td>
      <td>16</td>
      <td>0.789239</td>
      <td>0.793386</td>
      <td>0.791373</td>
      <td>0.791333</td>
      <td>0.001693</td>
      <td>17</td>
      <td>19.012726</td>
      <td>0.650604</td>
      <td>11.196412</td>
      <td>0.564934</td>
      <td>{'k': 20, 'min_k': 6, 'sim_options': {'name': ...</td>
      <td>20</td>
      <td>6</td>
      <td>{'name': 'cosine', 'user_based': False}</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.951610</td>
      <td>0.950883</td>
      <td>0.950264</td>
      <td>0.950919</td>
      <td>0.000550</td>
      <td>9</td>
      <td>0.734750</td>
      <td>0.734794</td>
      <td>0.733791</td>
      <td>0.734445</td>
      <td>0.000463</td>
      <td>9</td>
      <td>5.797267</td>
      <td>0.316200</td>
      <td>11.779861</td>
      <td>0.483101</td>
      <td>{'k': 20, 'min_k': 9, 'sim_options': {'name': ...</td>
      <td>20</td>
      <td>9</td>
      <td>{'name': 'msd', 'user_based': False}</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-f9506578-c167-4dc2-9efe-7e77009d28b5')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-f9506578-c167-4dc2-9efe-7e77009d28b5 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-f9506578-c167-4dc2-9efe-7e77009d28b5');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell markdown" id="rJkmvdsf2rUt">
<p>Now let's build the <strong>final model</strong> by using <strong>tuned values of the hyperparameters</strong> which we received by using grid search cross-validation.</p>
</div>
<div class="cell code" data-execution_count="55" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="46irii4pwICL" data-outputId="606cb5e4-685f-4387-8cf8-cd437650bb61">
<div class="sourceCode" id="cb78"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating an instance of KNNBasic with optimal hyperparameter values</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>similarity_algo_optimized_item <span class="op">=</span> KNNBasic(sim_options<span class="op">=</span>{<span class="st">&#39;name&#39;</span>: <span class="st">&#39;msd&#39;</span>, <span class="st">&#39;user_based&#39;</span>: <span class="va">False</span>}, k<span class="op">=</span><span class="dv">30</span>, min_k<span class="op">=</span><span class="dv">6</span>,verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Training the algorithm on the trainset</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>similarity_algo_optimized_item.fit(trainset)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting ratings for the testset</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> similarity_algo_optimized_item.test(testset)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing RMSE on testset</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>accuracy.rmse(predictions)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>RMSE: 0.9465
</code></pre>
</div>
<div class="output execute_result" data-execution_count="55">
<pre><code>0.9465120620317036</code></pre>
</div>
</div>
<div class="cell markdown" id="OTdrMpQUwICM">
<p>The final model has a RMSE of <strong>0.9465</strong>.</p>
</div>
<section id="q-44-what-is-the-predicted-rating-for-an-item-with-userid-4-and-for-movieid-10-and-movieid3-using-tuned-item-based-collaborative-filtering-1-mark" class="cell markdown" id="tiDcRQDvwICN">
<h3><strong>Q 4.4 What is the Predicted rating for an item with userId =4 and for movieId= 10 and movieId=3 using tuned item based collaborative filtering? (1 Mark)</strong></h3>
</section>
<div class="cell markdown" id="5IGjjEtpwICN">
<p>Let's us now predict rating for an user with <code>userId=4</code> and for <code>movieId=10</code> with the optimized model as shown below</p>
</div>
<div class="cell code" data-execution_count="56" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="Wg8APEG4wICO" data-outputId="19ce0650-267b-463d-9491-a3d5e26365ee">
<div class="sourceCode" id="cb81"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>similarity_algo_optimized_item.predict(<span class="dv">4</span>,<span class="dv">10</span>, r_ui<span class="op">=</span><span class="dv">4</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>user: 4          item: 10         r_ui = 4.00   est = 4.30   {&#39;actual_k&#39;: 30, &#39;was_impossible&#39;: False}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="56">
<pre><code>Prediction(uid=4, iid=10, r_ui=4, est=4.298279280483517, details={&#39;actual_k&#39;: 30, &#39;was_impossible&#39;: False})</code></pre>
</div>
</div>
<div class="cell markdown" id="qUXl61_5wICP">
<p>The predicted rating for movie 10 is <strong>4.298</strong>.</p>
</div>
<div class="cell markdown" id="HDNNs3cqwICP">
<p>Let's predict the rating for the same <code>userId=4</code> but for a movie which this user has not interacted before i.e. <code>movieId=3</code>, by using the optimized model:</p>
</div>
<div class="cell code" data-execution_count="57" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="oEew8TwvwICQ" data-outputId="c03ad4b8-a0e8-48a3-b15b-8814b310e97f">
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>similarity_algo_optimized_item.predict(<span class="dv">4</span>, <span class="dv">3</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>user: 4          item: 3          r_ui = None   est = 3.86   {&#39;actual_k&#39;: 30, &#39;was_impossible&#39;: False}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="57">
<pre><code>Prediction(uid=4, iid=3, r_ui=None, est=3.859023126306401, details={&#39;actual_k&#39;: 30, &#39;was_impossible&#39;: False})</code></pre>
</div>
</div>
<div class="cell markdown" id="sTKvXHU0wICR">
<p>The predicted rating for movie 3 is <strong>3.859</strong>.</p>
</div>
<section id="identifying-similar-users-to-a-given-user-nearest-neighbors" class="cell markdown" id="xquRIW-XwICS">
<h3><strong>Identifying similar users to a given user (nearest neighbors)</strong></h3>
<p>We can also find out the similar users to a given user or its nearest neighbors based on this KNNBasic algorithm. Below we are finding 5 most similar user to the <code>userId=4</code> based on the <code>msd</code> distance metric</p>
</section>
<div class="cell code" data-execution_count="58" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="b4HbXJv-wICS" data-outputId="5b3e6fa8-5a20-48b6-a791-f33cb03a7d7b">
<div class="sourceCode" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>similarity_algo_optimized_item.get_neighbors(<span class="dv">4</span>, k<span class="op">=</span><span class="dv">5</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="58">
<pre><code>[77, 85, 115, 119, 127]</code></pre>
</div>
</div>
<section id="predicted-top-5-movies-for-userid4-with-similarity-based-recommendation-system" class="cell markdown" id="PI69gPEdwICZ">
<h4><strong>Predicted top 5 movies for userId=4 with similarity based recommendation system</strong></h4>
</section>
<div class="cell code" data-execution_count="59" id="RAzdWtCSwICa">
<div class="sourceCode" id="cb89"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>recommendations <span class="op">=</span> get_recommendations(rating, <span class="dv">4</span>, <span class="dv">5</span>, similarity_algo_optimized_item)</span></code></pre></div>
</div>
<section id="q-45-predict-the-top-5-movies-for-userid4-with-similarity-based-recommendation-system-1-mark" class="cell markdown" id="_cDPuGWcwICb">
<h3><strong>Q 4.5 Predict the top 5 movies for userId=4 with similarity based recommendation system (1 Mark)</strong></h3>
</section>
<div class="cell code" data-execution_count="60" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="kJICKPecwICb" data-outputId="855e332c-8468-497f-e8a6-7ded7c2bd7bd">
<div class="sourceCode" id="cb90"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>recommendations</span></code></pre></div>
<div class="output execute_result" data-execution_count="60">
<pre><code>[(84, 5), (1040, 5), (2481, 5), (3515, 5), (4521, 5)]</code></pre>
</div>
</div>
<section id="model-4-based-collaborative-filtering---matrix-factorization-using-svd-7-marks" class="cell markdown" id="rKgJpSA9vOOL">
<h2><strong>Model 4: Based Collaborative Filtering - Matrix Factorization using SVD (7 Marks)</strong></h2>
</section>
<div class="cell markdown" id="YF6ZGyqhCAob">
<p>Model-based Collaborative Filtering is a <strong>personalized recommendation system</strong>, the recommendations are based on the past behavior of the user and it is not dependent on any additional information. We use <strong>latent features</strong> to find recommendations for each user.</p>
</div>
<div class="cell markdown" id="uxGWVpOMvOOL">
<p><strong>Latent Features:</strong> The features that are not present in the empirical data but can be inferred from the data. For example:</p>
</div>
<div class="cell markdown" id="ZfVDC0IuvOOL">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/2d9b2c9fdda625de45d5c004b11ed49e4d29a872.png" alt="test_image" /></p>
</div>
<div class="cell markdown" id="W2TTW8YfvOOL">
<p>Now if we notice the above movies closely:</p>
</div>
<div class="cell markdown" id="RDcl6w2WvOOL">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/b8725b83f50b30d78a408b0569be04ad2406afcf.png" alt="test_image" /></p>
</div>
<div class="cell markdown" id="3l7fsZWNvOOL">
<p>Here <strong>Action</strong>, <strong>Romance</strong>, <strong>Suspense</strong> and <strong>Comedy</strong> are latent features of the corresponding movies. Similarly, we can compute the latent features for users as shown below:</p>
</div>
<div class="cell markdown" id="0Ad4w7bvvOOL">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/8b49e32131c08b6a6039c4dc3c3e1d920e6c8b9d.png" alt="test_image" /></p>
</div>
<section id="singular-value-decomposition-svd" class="cell markdown" id="n4Otha8ovOOL">
<h3><strong>Singular Value Decomposition (SVD)</strong></h3>
</section>
<div class="cell markdown" id="3sGl3QkLvOOL">
<p>SVD is used to <strong>compute the latent features</strong> from the <strong>user-item matrix</strong>. But SVD does not work when we <strong>miss values</strong> in the <strong>user-item matrix</strong>.</p>
</div>
<div class="cell markdown" id="C80zDC6xvOOL">
<p>First we need to convert the below movie-rating dataset:</p>
</div>
<div class="cell markdown" id="xA_MGBrwvOOL">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/2d9b2c9fdda625de45d5c004b11ed49e4d29a872.png" alt="test_image" /></p>
</div>
<div class="cell markdown" id="3q39l4__vOOL">
<p>into an user-item matrix as shown below:</p>
</div>
<div class="cell markdown" id="kAz3MNfEvOOL">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/58777c856a24dcbbccc71c031f33d61b0beb9c0e.png" alt="test_image" /></p>
</div>
<div class="cell markdown" id="6piwQzq3vOOL">
<p>We have already done this above while computing cosine similarities.</p>
</div>
<div class="cell markdown" id="gOzTLIfIvOOL">
<p><strong>SVD decomposes this above matrix into three separate matrices:</strong></p>
<ul>
<li>U matrix</li>
<li>Sigma matrix</li>
<li>V transpose matrix</li>
</ul>
</div>
<section id="u-matrix" class="cell markdown" id="IVq1fCrBvOOL">
<h4><strong>U-matrix</strong></h4>
</section>
<div class="cell markdown" id="Y9wsChCmvOOL">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/d6cdbd767fe9c1bb808480975e957e6f1b5c9175.png" alt="test_image" /></p>
</div>
<div class="cell markdown" id="hA1dXvYXvOOL">
<p>the above matrix is a n x k matrix, where:</p>
<ul>
<li>n is number of users</li>
<li>k is number of latent features</li>
</ul>
</div>
<section id="sigma-matrix" class="cell markdown" id="dplq-n9dvOOL">
<h4><strong>Sigma-matrix</strong></h4>
</section>
<div class="cell markdown" id="kB6jCN5svOOL">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/500cbb904c6d9ddc7ff1d9f3f87ab4e718a20fe4.png" alt="test_image" /></p>
</div>
<div class="cell markdown" id="-twhbZ3wvOOL">
<p>the above matrix is a k x k matrix, where:</p>
<ul>
<li>k is number of latent features</li>
<li>Each diagonal entry is the singular value of the original interaction matrix</li>
</ul>
</div>
<section id="v-transpose-matrix" class="cell markdown" id="nr0dF0XcvOOL">
<h4><strong>V-transpose matrix</strong></h4>
</section>
<div class="cell markdown" id="hz82XFEgvOOL">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/8792a2e0bcc00eabfcbd70500f4fefad42c8fe1c.png" alt="test_image" /></p>
</div>
<div class="cell markdown" id="o9B1119q2N-M">
<p>the above matrix is a kxn matrix, where:</p>
<ul>
<li>k is the number of latent features</li>
<li>n is the number of items</li>
</ul>
</div>
<section id="build-a-baseline-matrix-factorization-recommendation-system" class="cell markdown" id="uOtkUXmAnVNL">
<h3><strong>Build a baseline matrix factorization recommendation system</strong></h3>
</section>
<div class="cell code" data-execution_count="61" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="07-2PT5Ssjqm" data-outputId="2534e3ca-6028-4054-9932-1d08903638b7">
<div class="sourceCode" id="cb92"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using SVD matrix factorization</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>algo_svd <span class="op">=</span> SVD()</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Training the algorithm on the trainset</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>algo_svd.fit(trainset)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting ratings for the testset</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> algo_svd.test(testset)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing RMSE on the testset</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>accuracy.rmse(predictions)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>RMSE: 0.9031
</code></pre>
</div>
<div class="output execute_result" data-execution_count="61">
<pre><code>0.9031390885282595</code></pre>
</div>
</div>
<section id="q-51-what-is-the-rmse-for-baseline-svd-based-collaborative-filtering-recommendation-system-1-mark" class="cell markdown" id="2271PkTuwICu">
<h3><strong>Q 5.1 What is the RMSE for baseline SVD based collaborative filtering recommendation system? (1 Mark)</strong></h3>
</section>
<div class="cell markdown" id="BQ6fTuCDnVNL">
<p>The baseline SVD-based system has an RMSE of <strong>0.9031</strong>.</p>
</div>
<section id="q-52-what-is-the-predicted-rating-for-an-user-with-userid-4-and-for-movieid-10-and-movieid3-1-mark" class="cell markdown" id="fsBGQrwCwICv">
<h3><strong>Q 5.2 What is the Predicted rating for an user with userId =4 and for movieId= 10 and movieId=3? (1 Mark)</strong></h3>
</section>
<div class="cell markdown" id="HD2AU1DnnVNM">
<p>Let's us now predict rating for an user with <code>userId=4</code> and for <code>movieId=10</code></p>
</div>
<div class="cell code" data-execution_count="62" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="yWIhfdxXsjqm" data-outputId="bd45be13-4bc7-4ff6-ec97-c4f1a5344095">
<div class="sourceCode" id="cb95"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>algo_svd.predict(<span class="dv">4</span>, <span class="dv">10</span>, r_ui<span class="op">=</span><span class="dv">4</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>user: 4          item: 10         r_ui = 4.00   est = 3.92   {&#39;was_impossible&#39;: False}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="62">
<pre><code>Prediction(uid=4, iid=10, r_ui=4, est=3.9176599589678984, details={&#39;was_impossible&#39;: False})</code></pre>
</div>
</div>
<div class="cell markdown" id="oIjzqDY5nVNM">
<p>The SVD system predicts a rating of <strong>3.918</strong> for movie 10 for user 4.</p>
</div>
<div class="cell markdown" id="I1aYxVeMnVNM">
<p>Let's predict the rating for the same <code>userId=4</code> but for a movie which this user has not interacted before i.e. <code>movieId=3</code>:</p>
</div>
<div class="cell code" data-execution_count="63" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="APm-uMSvcAMf" data-outputId="937f0f59-d6b2-42c6-89f8-8ea99681a715">
<div class="sourceCode" id="cb98"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>algo_svd.predict(<span class="dv">4</span>, <span class="dv">3</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>user: 4          item: 3          r_ui = None   est = 3.64   {&#39;was_impossible&#39;: False}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="63">
<pre><code>Prediction(uid=4, iid=3, r_ui=None, est=3.6373797205620138, details={&#39;was_impossible&#39;: False})</code></pre>
</div>
</div>
<div class="cell markdown" id="NEL6dy3wnVNM">
<p>The SVD system predicts a rating of <strong>3.637</strong> for movie 3 for user 4.</p>
</div>
<section id="improving-matrix-factorization-based-recommendation-system-by-tuning-its-hyper-parameters" class="cell markdown" id="x13Eb9Owvpcw">
<h3><strong>Improving matrix factorization based recommendation system by tuning its hyper-parameters</strong></h3>
</section>
<div class="cell markdown" id="qbd3L1d2nVNM">
<p>In SVD, rating is predicted as -</p>
</div>
<div class="cell markdown" id="Wp38lmEqnVNM">
<p><span class="math display"><em>r̂</em><sub><em>u</em><em>i</em></sub> = <em>μ</em> + <em>b</em><sub><em>u</em></sub> + <em>b</em><sub><em>i</em></sub> + <em>q</em><sub><em>i</em></sub><sup><em>T</em></sup><em>p</em><sub><em>u</em></sub></span></p>
</div>
<div class="cell markdown" id="bHVAYuFznVNN">
<p>If user <span class="math inline"><em>u</em></span> is unknown, then the bias <span class="math inline"><em>b</em><sub><em>u</em></sub></span> and the factors <span class="math inline"><em>p</em><sub><em>u</em></sub></span> are assumed to be zero. The same applies for item <span class="math inline"><em>i</em></span> with <span class="math inline"><em>b</em><sub><em>i</em></sub></span> and <span class="math inline"><em>q</em><sub><em>i</em></sub></span>.</p>
</div>
<div class="cell markdown" id="jCfY5mr7nVNN">
<p>To estimate all the unknown, we minimize the following regularized squared error:</p>
</div>
<div class="cell markdown" id="1WyyjmK7nVNN">
<p><span class="math display">∑<sub><em>r</em><sub><em>u</em><em>i</em></sub> ∈ <em>R</em><sub>train </sub></sub>(<em>r</em><sub><em>u</em><em>i</em></sub>−<em>r̂</em><sub><em>u</em><em>i</em></sub>)<sup>2</sup> + <em>λ</em>(<em>b</em><sub><em>i</em></sub><sup>2</sup>+<em>b</em><sub><em>u</em></sub><sup>2</sup>+∥<em>q</em><sub><em>i</em></sub>∥<sup>2</sup>+∥<em>p</em><sub><em>u</em></sub>∥<sup>2</sup>)</span></p>
</div>
<div class="cell markdown" id="-GBMNL9qnVNN">
<p>The minimization is performed by a very straightforward <strong>stochastic gradient descent</strong>:</p>
</div>
<div class="cell markdown" id="CwJJRsJGnVNN">
<p><span class="math display">$$\begin{aligned} b_{u} &amp; \leftarrow b_{u}+\gamma\left(e_{u i}-\lambda b_{u}\right) \\ b_{i} &amp; \leftarrow b_{i}+\gamma\left(e_{u i}-\lambda b_{i}\right) \\ p_{u} &amp; \leftarrow p_{u}+\gamma\left(e_{u i} \cdot q_{i}-\lambda p_{u}\right) \\ q_{i} &amp; \leftarrow q_{i}+\gamma\left(e_{u i} \cdot p_{u}-\lambda q_{i}\right) \end{aligned}$$</span></p>
</div>
<div class="cell markdown" id="nuRjcsUknVNN">
<p>There are many hyperparameters to tune in this algorithm, you can find a full list of hyperparameters <a href="https://surprise.readthedocs.io/en/stable/matrix_factorization.html#surprise.prediction_algorithms.matrix_factorization.SVD">here</a></p>
</div>
<div class="cell markdown" id="iQcDPhhcnVNN">
<p>Below we will be tuning only three hyperparameters -</p>
<ul>
<li><strong>n_epochs</strong>: The number of iteration of the SGD algorithm</li>
<li><strong>lr_all</strong>: The learning rate for all parameters</li>
<li><strong>reg_all</strong>: The regularization term for all parameters</li>
</ul>
</div>
<section id="q-53-perform-hyperparameter-tuning-for-the-baseline-svd-based-collaborative-filtering-recommendation-system-and-find-the-rmse-for-tuned-svd-based-collaborative-filtering-recommendation-system-3-marks" class="cell markdown" id="ksN4zUnUwIC_">
<h3><strong>Q 5.3 Perform hyperparameter tuning for the baseline SVD based collaborative filtering recommendation system and find the RMSE for tuned SVD based collaborative filtering recommendation system? (3 Marks)</strong></h3>
</section>
<div class="cell code" data-execution_count="64" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="4bM81V_hvtwv" data-outputId="a5373a30-89f0-432a-e00a-4dc624eb37b7">
<div class="sourceCode" id="cb101"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the parameter space to tune</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">&#39;n_epochs&#39;</span>: [<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>], <span class="st">&#39;lr_all&#39;</span>: [<span class="fl">0.001</span>, <span class="fl">0.005</span>, <span class="fl">0.01</span>],</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;reg_all&#39;</span>: [<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>]}</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Performing 3-fold gridsearch cross validation</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>gs <span class="op">=</span> GridSearchCV(SVD, param_grid, measures<span class="op">=</span>[<span class="st">&#39;rmse&#39;</span>, <span class="st">&#39;mae&#39;</span>], cv<span class="op">=</span><span class="dv">3</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting data</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>gs.fit(data)</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Best RMSE score</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gs.best_score[<span class="st">&#39;rmse&#39;</span>])</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Combination of parameters that gave the best RMSE score</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gs.best_params[<span class="st">&#39;rmse&#39;</span>])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>0.8937463944379922
{&#39;n_epochs&#39;: 30, &#39;lr_all&#39;: 0.01, &#39;reg_all&#39;: 0.2}
</code></pre>
</div>
</div>
<div class="cell markdown" id="cjIaWSIAnVNN">
<p>Once the <strong>grid search</strong> is complete, we can get the <strong>optimal values</strong> for each of those hyperparameters, as shown above.</p>
</div>
<div class="cell markdown" id="2CfLdGf0nVNN">
<p>Below we are analysing evaluation metrics - RMSE and MAE at each and every split to analyze the impact of each value of hyperparameters</p>
</div>
<div class="cell code" data-execution_count="65" data-colab="{&quot;height&quot;:617,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="RMb3t3z_vt8W" data-outputId="1edea762-644e-4e74-e7d2-ab40a15708a6">
<div class="sourceCode" id="cb103"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> pd.DataFrame.from_dict(gs.cv_results)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>results_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="65">

  <div id="df-876fe832-8bfc-43d8-a66b-ddc1bf7e8d8f">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>split0_test_rmse</th>
      <th>split1_test_rmse</th>
      <th>split2_test_rmse</th>
      <th>mean_test_rmse</th>
      <th>std_test_rmse</th>
      <th>rank_test_rmse</th>
      <th>split0_test_mae</th>
      <th>split1_test_mae</th>
      <th>split2_test_mae</th>
      <th>mean_test_mae</th>
      <th>std_test_mae</th>
      <th>rank_test_mae</th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_test_time</th>
      <th>std_test_time</th>
      <th>params</th>
      <th>param_n_epochs</th>
      <th>param_lr_all</th>
      <th>param_reg_all</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.937088</td>
      <td>0.941831</td>
      <td>0.950693</td>
      <td>0.943204</td>
      <td>0.005638</td>
      <td>25</td>
      <td>0.734681</td>
      <td>0.736846</td>
      <td>0.742574</td>
      <td>0.738034</td>
      <td>0.003330</td>
      <td>25</td>
      <td>4.822517</td>
      <td>0.412795</td>
      <td>0.588699</td>
      <td>0.047995</td>
      <td>{'n_epochs': 10, 'lr_all': 0.001, 'reg_all': 0.2}</td>
      <td>10</td>
      <td>0.001</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.941132</td>
      <td>0.946314</td>
      <td>0.955085</td>
      <td>0.947510</td>
      <td>0.005759</td>
      <td>26</td>
      <td>0.739717</td>
      <td>0.742279</td>
      <td>0.747904</td>
      <td>0.743300</td>
      <td>0.003419</td>
      <td>26</td>
      <td>5.001963</td>
      <td>0.058948</td>
      <td>0.622447</td>
      <td>0.061483</td>
      <td>{'n_epochs': 10, 'lr_all': 0.001, 'reg_all': 0.4}</td>
      <td>10</td>
      <td>0.001</td>
      <td>0.4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.946071</td>
      <td>0.951274</td>
      <td>0.960601</td>
      <td>0.952649</td>
      <td>0.006011</td>
      <td>27</td>
      <td>0.744921</td>
      <td>0.747856</td>
      <td>0.753383</td>
      <td>0.748720</td>
      <td>0.003508</td>
      <td>27</td>
      <td>5.115259</td>
      <td>0.133874</td>
      <td>0.694518</td>
      <td>0.083622</td>
      <td>{'n_epochs': 10, 'lr_all': 0.001, 'reg_all': 0.6}</td>
      <td>10</td>
      <td>0.001</td>
      <td>0.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.899909</td>
      <td>0.907059</td>
      <td>0.913570</td>
      <td>0.906846</td>
      <td>0.005579</td>
      <td>10</td>
      <td>0.698638</td>
      <td>0.702193</td>
      <td>0.706866</td>
      <td>0.702566</td>
      <td>0.003369</td>
      <td>9</td>
      <td>4.998776</td>
      <td>0.122980</td>
      <td>0.601300</td>
      <td>0.095280</td>
      <td>{'n_epochs': 10, 'lr_all': 0.005, 'reg_all': 0.2}</td>
      <td>10</td>
      <td>0.005</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.907404</td>
      <td>0.913606</td>
      <td>0.920989</td>
      <td>0.914000</td>
      <td>0.005553</td>
      <td>15</td>
      <td>0.706287</td>
      <td>0.709524</td>
      <td>0.714526</td>
      <td>0.710112</td>
      <td>0.003389</td>
      <td>15</td>
      <td>4.929785</td>
      <td>0.117247</td>
      <td>0.628400</td>
      <td>0.108293</td>
      <td>{'n_epochs': 10, 'lr_all': 0.005, 'reg_all': 0.4}</td>
      <td>10</td>
      <td>0.005</td>
      <td>0.4</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-876fe832-8bfc-43d8-a66b-ddc1bf7e8d8f')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-876fe832-8bfc-43d8-a66b-ddc1bf7e8d8f button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-876fe832-8bfc-43d8-a66b-ddc1bf7e8d8f');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell markdown" id="KzY78HsrnVNO">
<p>Now, we will <strong>the build final model</strong> by using <strong>tuned values</strong> of the hyperparameters, which we received using grid search cross-validation above.</p>
</div>
<div class="cell code" data-execution_count="67" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="TA_7xe-nnhuu" data-outputId="72444906-355b-4bba-f315-2d0f5ba207cc">
<div class="sourceCode" id="cb104"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Building the optimized SVD model using optimal hyperparameter search</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>svd_algo_optimized <span class="op">=</span> SVD(n_epochs<span class="op">=</span><span class="dv">20</span>, lr_all<span class="op">=</span><span class="fl">0.01</span>, reg_all<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Training the algorithm on the trainset</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>svd_algo_optimized.fit(trainset)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting ratings for the testset</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> svd_algo_optimized.test(testset)</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing RMSE</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>accuracy.rmse(predictions)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>RMSE: 0.8973
</code></pre>
</div>
<div class="output execute_result" data-execution_count="67">
<pre><code>0.8972580357427976</code></pre>
</div>
</div>
<section id="q-54-what-is-the-predicted-rating-for-an-user-with-userid-4-and-for-movieid-10-and-movieid3-using-svd-based-collaborative-filtering-1-mark" class="cell markdown" id="UruWuDiCwIDE">
<h3><strong>Q 5.4 What is the Predicted rating for an user with userId =4 and for movieId= 10 and movieId=3 using SVD based collaborative filtering? (1 Mark)</strong></h3>
</section>
<div class="cell markdown" id="md0-dL56nVNO">
<p>Let's us now predict rating for an user with <code>userId=4</code> and for <code>movieId=10</code> with the optimized model</p>
</div>
<div class="cell code" data-execution_count="68" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="s6C1PAfboM8_" data-outputId="33a89f39-677b-4601-ee1c-8bc58246bd4c">
<div class="sourceCode" id="cb107"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>svd_algo_optimized.predict(<span class="dv">4</span>, <span class="dv">10</span>, r_ui<span class="op">=</span><span class="dv">4</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>user: 4          item: 10         r_ui = 4.00   est = 3.97   {&#39;was_impossible&#39;: False}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="68">
<pre><code>Prediction(uid=4, iid=10, r_ui=4, est=3.9746300660681904, details={&#39;was_impossible&#39;: False})</code></pre>
</div>
</div>
<div class="cell markdown" id="VdiEtzEznVNO">
<p>The predicted rating of movie 10 for user 4 using SVD collab filtering is <strong>3.975</strong>.</p>
</div>
<div class="cell markdown" id="Qd2bRtIQ4ze5">
<p>Let's predict the rating for the same <code>userId=4</code> but for a movie which this user has not interacted before i.e. <code>movieId=3</code>:</p>
</div>
<div class="cell code" data-execution_count="69" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="k1xjn3kOoQyg" data-outputId="d5c0c5dd-6a67-445b-953d-398dcdc1e170">
<div class="sourceCode" id="cb110"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>svd_algo_optimized.predict(<span class="dv">4</span>, <span class="dv">3</span>, verbose<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>user: 4          item: 3          r_ui = None   est = 3.65   {&#39;was_impossible&#39;: False}
</code></pre>
</div>
<div class="output execute_result" data-execution_count="69">
<pre><code>Prediction(uid=4, iid=3, r_ui=None, est=3.6494509461174185, details={&#39;was_impossible&#39;: False})</code></pre>
</div>
</div>
<div class="cell markdown" id="TUUrKd0q95Xz">
<p>The predicted rating of movie 3 for user 4 using SVD collab filtering is <strong>3.649</strong>.</p>
</div>
<section id="q-55-predict-the-top-5-movies-for-userid4-with-svd-based-recommendation-system1-mark" class="cell markdown" id="5jlUBrbFwIDH">
<h3><strong>Q 5.5 Predict the top 5 movies for userId=4 with SVD based recommendation system?(1 Mark)</strong></h3>
</section>
<div class="cell code" data-execution_count="70" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="1LGeE2EB_n90" data-outputId="86d474d6-cbd0-4fd8-b32a-311697d19dab">
<div class="sourceCode" id="cb113"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>get_recommendations(rating, <span class="dv">4</span>, <span class="dv">5</span>, svd_algo_optimized)</span></code></pre></div>
<div class="output execute_result" data-execution_count="70">
<pre><code>[(926, 4.938831611532595),
 (1192, 4.911663964684779),
 (1217, 4.876880839499725),
 (3035, 4.864153522050881),
 (232, 4.8568399745706605)]</code></pre>
</div>
</div>
<section id="predicting-ratings-for-already-interacted-movies" class="cell markdown" id="xgKmqss1vqGz">
<h3><strong>Predicting ratings for already interacted movies</strong></h3>
</section>
<div class="cell markdown" id="nNlUEB13wIDJ">
<p>Below we are comparing the rating predictions of users for those movies which has been already watched by an user. This will help us to understand how well are predictions are as compared to the actual ratings provided by users</p>
</div>
<div class="cell code" data-execution_count="71" id="hQIPHA7-vg7W">
<div class="sourceCode" id="cb115"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict_already_interacted_ratings(data, user_id, algo):</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Creating an empty list to store the recommended movie ids</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    recommendations <span class="op">=</span> []</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Creating an user item interactions matrix </span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>    user_item_interactions_matrix <span class="op">=</span> data.pivot(index<span class="op">=</span><span class="st">&#39;userId&#39;</span>, columns<span class="op">=</span><span class="st">&#39;movieId&#39;</span>, values<span class="op">=</span><span class="st">&#39;rating&#39;</span>)</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extracting those movie ids which the user_id has interacted already</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>    interacted_movies <span class="op">=</span> user_item_interactions_matrix.loc[user_id][user_item_interactions_matrix.loc[user_id].notnull()].index.tolist()</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Looping through each of the movie id which user_id has interacted already</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item_id <span class="kw">in</span> interacted_movies:</span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extracting actual ratings</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>        actual_rating <span class="op">=</span> user_item_interactions_matrix.loc[user_id, item_id]</span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predicting the ratings for those non interacted movie ids by this user</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>        predicted_rating <span class="op">=</span> algo.predict(user_id, item_id).est</span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Appending the predicted ratings</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>        recommendations.append((item_id, actual_rating, predicted_rating))</span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sorting the predicted ratings in descending order</span></span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>    recommendations.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(recommendations, columns<span class="op">=</span>[<span class="st">&#39;movieId&#39;</span>, <span class="st">&#39;actual_rating&#39;</span>, <span class="st">&#39;predicted_rating&#39;</span>]) <span class="co"># returing top n highest predicted rating movies for this user</span></span></code></pre></div>
</div>
<div class="cell markdown" id="5T0q833lwIDK">
<p>Here we are comparing the predicted ratings by <code>similarity based recommendation</code> system against actual ratings for <code>userId=7</code></p>
</div>
<div class="cell code" data-execution_count="72" data-colab="{&quot;height&quot;:369,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="IWQvGj-vyWj3" data-outputId="793276eb-394b-4cd5-efdc-a88df57029bb">
<div class="sourceCode" id="cb116"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>predicted_ratings_for_interacted_movies <span class="op">=</span> predict_already_interacted_ratings(rating, <span class="dv">7</span>, similarity_algo_optimized_item)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> predicted_ratings_for_interacted_movies.melt(id_vars<span class="op">=</span><span class="st">&#39;movieId&#39;</span>, value_vars<span class="op">=</span>[<span class="st">&#39;actual_rating&#39;</span>, <span class="st">&#39;predicted_rating&#39;</span>])</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>sns.displot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">&#39;value&#39;</span>, hue<span class="op">=</span><span class="st">&#39;variable&#39;</span>, kde<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/715ecfcc8a99ff1f9055ca8b850865c926e20f0e.png" /></p>
</div>
</div>
<div class="cell markdown" id="jfNXSEw9wIDM">
<p>Below we are comparing the predicted ratings by <code>matrix factorization based recommendation</code> system against actual ratings for <code>userId=7</code></p>
</div>
<div class="cell code" data-execution_count="73" data-colab="{&quot;height&quot;:369,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="6lYjMDhU0xuQ" data-outputId="66ea40ae-95cf-408a-be36-2d821a904f02">
<div class="sourceCode" id="cb117"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>predicted_ratings_for_interacted_movies <span class="op">=</span> predict_already_interacted_ratings(rating, <span class="dv">7</span>, svd_algo_optimized)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> predicted_ratings_for_interacted_movies.melt(id_vars<span class="op">=</span><span class="st">&#39;movieId&#39;</span>, value_vars<span class="op">=</span>[<span class="st">&#39;actual_rating&#39;</span>, <span class="st">&#39;predicted_rating&#39;</span>])</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>sns.displot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">&#39;value&#39;</span>, hue<span class="op">=</span><span class="st">&#39;variable&#39;</span>, kde<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_e2f49f1f92414f9cbcee8e1939566e1a/f083e4ed4fb406576c4f9abfeba7e8775763ca63.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="74" id="aT0zASb-wIDO">
<div class="sourceCode" id="cb118"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiating Reader scale with expected rating scale</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>reader <span class="op">=</span> Reader(rating_scale<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">5</span>))</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the rating dataset</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> Dataset.load_from_df(rating[[<span class="st">&#39;userId&#39;</span>, <span class="st">&#39;movieId&#39;</span>, <span class="st">&#39;rating&#39;</span>]], reader)</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into train and test dataset</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>trainset, testset <span class="op">=</span> train_test_split(data, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code></pre></div>
</div>
<section id="precision-and-recall--k" class="cell markdown" id="kGbfBUnawIDO">
<h2><strong>Precision and Recall @ k</strong></h2>
<p>RMSE is not the only metric we can use here. We can also examine two fundamental measures, precision and recall. We also add a parameter k which is helpful in understanding problems with multiple rating outputs.</p>
<p><strong><a href="mailto:Precision@k" class="email">Precision@k</a></strong> - It is the <strong>fraction of recommended items that are relevant in <code>top k</code> predictions</strong>. Value of k is the number of recommendations to be provided to the user. One can choose a variable number of recommendations to be given to a unique user.</p>
<p><strong><a href="mailto:Recall@k" class="email">Recall@k</a></strong> - It is the <strong>fraction of relevant items that are recommended to the user in <code>top k</code> predictions</strong>.</p>
<p><strong>Recall</strong> - It is the <strong>fraction of actually relevant items that are recommended to the user</strong> i.e. if out of 10 relevant movies, 6 are recommended to the user then recall is 0.60. Higher the value of recall better is the model. It is one of the metrics to do the performance assessment of classification models.</p>
<p><strong>Precision</strong> - It is the <strong>fraction of recommended items that are relevant actually</strong> i.e. if out of 10 recommended items, 6 are found relevant by the user then precision is 0.60. The higher the value of precision better is the model. It is one of the metrics to do the performance assessment of classification models.</p>
<p>See the Precision and Recall @ k section of your notebook and follow the instructions to compute various precision/recall values at various values of k.</p>
<p>To know more about precision recall in Recommendation systems refer to these links :</p>
<p><a href="https://surprise.readthedocs.io/en/stable/FAQ.html" class="uri">https://surprise.readthedocs.io/en/stable/FAQ.html</a></p>
<p><a href="https://medium.com/@m_n_malaeb/recall-and-precision-at-k-for-recommender-systems-618483226c54" class="uri">https://medium.com/@m_n_malaeb/recall-and-precision-at-k-for-recommender-systems-618483226c54</a></p>
</section>
<section id="question-6-compute-the-precision-and-recall-for-each-of-the-6-models-at-k--5-and-10-this-is-6-x-2--12-numerical-values-4-marks" class="cell markdown" id="b_norGWOwIDP">
<h3><strong>Question 6: Compute the precision and recall, for each of the 6 models, at k = 5 and 10. This is 6 x 2 = 12 numerical values? (4 marks)</strong></h3>
</section>
<div class="cell code" data-execution_count="75" id="gihoUY5uwIDQ" data-scrolled="false">
<div class="sourceCode" id="cb119"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function can be found on surprise documentation FAQs</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> precision_recall_at_k(predictions, k<span class="op">=</span><span class="dv">10</span>, threshold<span class="op">=</span><span class="fl">3.5</span>):</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Return precision and recall at k metrics for each user&quot;&quot;&quot;</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># First map the predictions to each user.</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>    user_est_true <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> uid, _, true_r, est, _ <span class="kw">in</span> predictions:</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>        user_est_true[uid].append((est, true_r))</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>    precisions <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>    recalls <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> uid, user_ratings <span class="kw">in</span> user_est_true.items():</span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sort user ratings by estimated value</span></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>        user_ratings.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">0</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Number of relevant items</span></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>        n_rel <span class="op">=</span> <span class="bu">sum</span>((true_r <span class="op">&gt;=</span> threshold) <span class="cf">for</span> (_, true_r) <span class="kw">in</span> user_ratings)</span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Number of recommended items in top k</span></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a>        n_rec_k <span class="op">=</span> <span class="bu">sum</span>((est <span class="op">&gt;=</span> threshold) <span class="cf">for</span> (est, _) <span class="kw">in</span> user_ratings[:k])</span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Number of relevant and recommended items in top k</span></span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a>        n_rel_and_rec_k <span class="op">=</span> <span class="bu">sum</span>(((true_r <span class="op">&gt;=</span> threshold) <span class="kw">and</span> (est <span class="op">&gt;=</span> threshold))</span>
<span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a>                              <span class="cf">for</span> (est, true_r) <span class="kw">in</span> user_ratings[:k])</span>
<span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-27"><a href="#cb119-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Precision@K: Proportion of recommended items that are relevant</span></span>
<span id="cb119-28"><a href="#cb119-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># When n_rec_k is 0, Precision is undefined. We here set it to 0.</span></span>
<span id="cb119-29"><a href="#cb119-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-30"><a href="#cb119-30" aria-hidden="true" tabindex="-1"></a>        precisions[uid] <span class="op">=</span> n_rel_and_rec_k <span class="op">/</span> n_rec_k <span class="cf">if</span> n_rec_k <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb119-31"><a href="#cb119-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-32"><a href="#cb119-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Recall@K: Proportion of relevant items that are recommended</span></span>
<span id="cb119-33"><a href="#cb119-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># When n_rel is 0, Recall is undefined. We here set it to 0.</span></span>
<span id="cb119-34"><a href="#cb119-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-35"><a href="#cb119-35" aria-hidden="true" tabindex="-1"></a>        recalls[uid] <span class="op">=</span> n_rel_and_rec_k <span class="op">/</span> n_rel <span class="cf">if</span> n_rel <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb119-36"><a href="#cb119-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-37"><a href="#cb119-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> precisions, recalls</span>
<span id="cb119-38"><a href="#cb119-38" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="76" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="57qD5TFRnm1W" data-outputId="78dee03f-cc99-4629-96dd-190528fbb87c">
<div class="sourceCode" id="cb120"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A basic cross-validation iterator.</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(n_splits<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make list of k values</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> [<span class="dv">5</span>, <span class="dv">10</span>]</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove _______ and complete the code</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Make list of models</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [algo_knn_user, similarity_algo_optimized_user,algo_knn_item,similarity_algo_optimized_item, algo_svd, svd_algo_optimized]</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> K:</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model <span class="kw">in</span> models:</span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;&gt; k=</span><span class="sc">{}</span><span class="st">, model=</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(k,model.__class__.<span class="va">__name__</span>))</span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> []</span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> []</span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> trainset, testset <span class="kw">in</span> kf.split(data):</span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>            model.fit(trainset)</span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>            predictions <span class="op">=</span> model.test(testset, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a>            precisions, recalls <span class="op">=</span> precision_recall_at_k(predictions, k<span class="op">=</span>k, threshold<span class="op">=</span><span class="fl">3.5</span>)</span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Precision and recall can then be averaged over all users</span></span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a>            p.append(<span class="bu">sum</span>(prec <span class="cf">for</span> prec <span class="kw">in</span> precisions.values()) <span class="op">/</span> <span class="bu">len</span>(precisions))</span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a>            r.append(<span class="bu">sum</span>(rec <span class="cf">for</span> rec <span class="kw">in</span> recalls.values()) <span class="op">/</span> <span class="bu">len</span>(recalls))</span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb120-25"><a href="#cb120-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;-----&gt; Precision: &#39;</span>, <span class="bu">round</span>(<span class="bu">sum</span>(p) <span class="op">/</span> <span class="bu">len</span>(p), <span class="dv">3</span>))</span>
<span id="cb120-26"><a href="#cb120-26" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;-----&gt; Recall: &#39;</span>, <span class="bu">round</span>(<span class="bu">sum</span>(r) <span class="op">/</span> <span class="bu">len</span>(r), <span class="dv">3</span>))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&gt; k=5, model=KNNBasic
-----&gt; Precision:  0.764
-----&gt; Recall:  0.414
&gt; k=5, model=KNNBasic
-----&gt; Precision:  0.77
-----&gt; Recall:  0.42
&gt; k=5, model=KNNBasic
-----&gt; Precision:  0.604
-----&gt; Recall:  0.322
&gt; k=5, model=KNNBasic
-----&gt; Precision:  0.684
-----&gt; Recall:  0.358
&gt; k=5, model=SVD
-----&gt; Precision:  0.756
-----&gt; Recall:  0.386
&gt; k=5, model=SVD
-----&gt; Precision:  0.749
-----&gt; Recall:  0.384
&gt; k=10, model=KNNBasic
-----&gt; Precision:  0.754
-----&gt; Recall:  0.549
&gt; k=10, model=KNNBasic
-----&gt; Precision:  0.75
-----&gt; Recall:  0.561
&gt; k=10, model=KNNBasic
-----&gt; Precision:  0.597
-----&gt; Recall:  0.475
&gt; k=10, model=KNNBasic
-----&gt; Precision:  0.665
-----&gt; Recall:  0.505
&gt; k=10, model=SVD
-----&gt; Precision:  0.738
-----&gt; Recall:  0.522
&gt; k=10, model=SVD
-----&gt; Precision:  0.731
-----&gt; Recall:  0.523
</code></pre>
</div>
</div>
<section id="question-7--5-marks" class="cell markdown" id="08dezW5P6O1Z">
<h3><strong>Question 7 ( 5 Marks)</strong></h3>
<p><strong>7.1 Compare the results from the base line user-user and item-item based models.</strong></p>
<p><strong>7.2 How do these baseline models compare to each other with respect to the tuned user-user and item-item models?</strong></p>
<p><strong>7.3 The matrix factorization model is different from the collaborative filtering models. Briefly describe this difference. Also, compare the RMSE and precision recall for the models.</strong></p>
<p><strong>7.4 Does it improve? Can you offer any reasoning as to why that might be?</strong></p>
</section>
<div class="cell markdown" id="2W0MdIZ1wIDS">
<p>Baseline user-based and item-based Collaborative Models have nearly the same RMSE values.</p>
<p>Clearly, tuned Collaborative Filtering Models have performed better than baseline model and the user-user based tuned model is performing better and have rmse of 0.9908.</p>
<p>The Collaborative Models use the user-item-ratings data to find similarities and make predictions rather than just predicting a random rating based on the distribution of the data. This could a reason why the Collaborative filtering performed well.</p>
<p>Collaborative Filtering searches for neighbors based on similarity of item (example) preferences and recommend items that those neighbors interacted while Matrix factorization works by decomposing the user-item matrix into the product of two lower dimensionality rectangular matrices.</p>
<p>RMSE for Matrix Factorization is better than the Collaborative Filtering Model.</p>
<p>Tuning SVD matrix factorization model is not improving the base line SVD much. Matrix Factorization has lower RMSE due to the reason that it assumes that both items and users are present in some low dimensional space describing their properties and recommend a item based on its proximity to the user in the latent space.</p>
</div>
<section id="conclusions" class="cell markdown" id="TgDOPCXOvOOM">
<h3><strong>Conclusions</strong></h3>
</section>
<div class="cell markdown" id="WJ4L2PwQvOOM">
<p>In this case study, we saw three different ways of building recommendation systems:</p>
<ul>
<li>rank-based using averages</li>
<li>similarity-based collaborative filtering</li>
<li>model-based (matrix factorization) collaborative filtering</li>
</ul>
</div>
<div class="cell markdown" id="4XP9B9bVvOOM">
<p>We also understood advantages/disadvantages of these recommendation systems and when to use which kind of recommendation systems. Once we build these recommendation systems, we can use <strong>A/B Testing</strong> to measure the effectiveness of these systems.</p>
</div>
<div class="cell markdown" id="fAQfeVYLvOOM">
<p>Here is an article explaining how <a href="https://aws.amazon.com/blogs/machine-learning/using-a-b-testing-to-measure-the-efficacy-of-recommendations-generated-by-amazon-personalize/">Amazon use <strong>A/B Testing</strong></a> to measure effectiveness of its recommendation systems.</p>
</div>
</body>
</html>
